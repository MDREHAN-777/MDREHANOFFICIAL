<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MR7 WORLD - Gaming + AI</title>

<style>
  :root{
    --bg:#050505;
    --card:#0b0b0b;
    --green:#00ff44;
    --green2:#00cc33;
    --text:#eaffea;
    --muted:#aaffaa;
    --shadow: 0 0 25px rgba(0,255,68,.35);
    --shadow2: 0 0 50px rgba(0,255,68,.25);
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Arial,sans-serif;}
  body{
    background: radial-gradient(circle at top, #0c0c0c, #020202);
    color:var(--text);
    overflow-x:hidden;
  }

  /* PRELOADER */
  #preloader{
    position:fixed; inset:0;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:99999;
  }
  .loaderCircle{
    width:90px;height:90px;
    border:6px solid rgba(0,255,68,.15);
    border-top:6px solid var(--green);
    border-radius:50%;
    animation:spin 1s linear infinite;
    box-shadow:var(--shadow);
  }
  #preloader p{
    margin-top:15px;
    color:var(--green);
    letter-spacing:2px;
    font-weight:bold;
    text-shadow:0 0 10px rgba(0,255,68,.5);
  }
  @keyframes spin{to{transform:rotate(360deg);}}


  /* PARTICLES CANVAS */
  canvas#particles{
    position:fixed;
    inset:0;
    z-index:-1;
  }

  /* HEADER */
  header{
    position:sticky;
    top:0;
    background:rgba(0,0,0,.75);
    backdrop-filter: blur(8px);
    border-bottom:1px solid rgba(0,255,68,.2);
    padding:14px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    z-index:999;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:12px;
  }

  .logo{
    width:48px;height:48px;
    border-radius:50%;
    border:2px solid var(--green);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    color:var(--green);
    box-shadow:var(--shadow);
    background:rgba(0,255,68,.06);
  }

  .brandTitle{
    font-size:20px;
    font-weight:900;
    color:var(--green);
    text-shadow:0 0 12px rgba(0,255,68,.6);
  }
  .verified{
    font-size:13px;
    color:#caffca;
    opacity:.9;
    margin-left:6px;
  }

  .status{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
    color:#d6ffd6;
  }
  .dot{
    width:10px;height:10px;border-radius:50%;
    background:#00ff44;
    box-shadow:0 0 10px rgba(0,255,68,.7);
  }
  .dot.off{background:red;box-shadow:0 0 10px rgba(255,0,0,.6);}

  /* MENU */
  .menuBtn{
    width:44px;height:44px;
    border-radius:12px;
    border:1px solid rgba(0,255,68,.35);
    background:rgba(0,255,68,.08);
    color:var(--green);
    font-size:22px;
    cursor:pointer;
    transition:.2s;
    box-shadow:var(--shadow);
  }
  .menuBtn:hover{transform:scale(1.06);}

  #menuPanel{
    position:fixed;
    top:0; right:-320px;
    width:320px;
    height:100vh;
    background:rgba(0,0,0,.92);
    border-left:2px solid rgba(0,255,68,.25);
    padding:18px;
    z-index:9999;
    transition:.35s ease;
    backdrop-filter: blur(10px);
  }
  #menuPanel.active{right:0;}

  #menuPanel h2{
    color:var(--green);
    margin-bottom:10px;
    text-shadow:0 0 10px rgba(0,255,68,.5);
  }

  .searchBox{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(0,255,68,.25);
    background:#070707;
    color:var(--text);
    outline:none;
    margin-bottom:14px;
  }

  .menuItem{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(0,255,68,.2);
    background:rgba(0,255,68,.06);
    color:var(--text);
    cursor:pointer;
    margin-bottom:10px;
    transition:.2s;
    text-align:left;
    font-weight:700;
  }
  .menuItem:hover{
    transform:translateX(6px);
    box-shadow:0 0 15px rgba(0,255,68,.25);
  }

  .closeMenu{
    margin-top:12px;
    width:100%;
    padding:12px;
    border-radius:14px;
    border:none;
    background:var(--green);
    color:#000;
    font-weight:900;
    cursor:pointer;
  }

  /* MAIN CONTAINER */
  .container{
    max-width:1100px;
    margin:25px auto;
    padding:15px;
  }

  /* PAGE */
  .page{
    display:none;
    animation:fadeIn .35s ease;
  }
  .page.active{display:block;}
  @keyframes fadeIn{
    from{opacity:0; transform:translateY(20px) scale(.98);}
    to{opacity:1; transform:translateY(0) scale(1);}
  }

  /* CARDS */
  .card{
    background:rgba(0,0,0,.72);
    border:1px solid rgba(0,255,68,.25);
    border-radius:22px;
    padding:20px;
    box-shadow:var(--shadow2);
    margin-bottom:18px;
  }

  .card h1, .card h2{
    color:var(--green);
    text-shadow:0 0 12px rgba(0,255,68,.6);
    margin-bottom:10px;
  }
  .card p{color:#d7ffd7; opacity:.95;}

  .btnRow{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:15px;
  }

  .btn{
    padding:12px 16px;
    border-radius:16px;
    border:none;
    background:var(--green);
    color:#000;
    font-weight:900;
    cursor:pointer;
    transition:.2s;
  }
  .btn:hover{transform:scale(1.06);}

  .btn.dark{
    background:rgba(0,255,68,.12);
    border:1px solid rgba(0,255,68,.25);
    color:var(--text);
  }

  /* PROFILE CARD */
  .profile{
    display:flex;
    align-items:center;
    gap:15px;
    flex-wrap:wrap;
  }
  .profilePic{
    width:80px;height:80px;
    border-radius:18px;
    border:2px solid rgba(0,255,68,.6);
    box-shadow:var(--shadow);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    font-weight:900;
    color:var(--green);
    background:rgba(0,255,68,.06);
  }
  .socialLinks{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:10px;
  }
  .socialLinks a{
    text-decoration:none;
    padding:10px 14px;
    border-radius:14px;
    border:1px solid rgba(0,255,68,.25);
    background:rgba(0,255,68,.08);
    color:#eaffea;
    font-weight:800;
    transition:.2s;
  }
  .socialLinks a:hover{
    transform:translateY(-3px);
    box-shadow:0 0 18px rgba(0,255,68,.25);
  }

  /* FULLSCREEN BUTTON */
  .fullscreenBtn{
    position:fixed;
    bottom:18px;
    right:18px;
    z-index:999;
    padding:14px 18px;
    border-radius:18px;
    border:none;
    background:var(--green);
    color:#000;
    font-weight:900;
    cursor:pointer;
    box-shadow:var(--shadow);
  }

  /* NOTIFICATION POPUP */
  #popup{
    position:fixed;
    top:80px;
    right:20px;
    background:rgba(0,0,0,.9);
    border:1px solid rgba(0,255,68,.3);
    padding:14px 18px;
    border-radius:18px;
    box-shadow:var(--shadow2);
    z-index:9999;
    transform:translateX(400px);
    transition:.5s;
  }
  #popup.show{transform:translateX(0);}
  #popup h3{color:var(--green); margin-bottom:5px;}
  #popup p{color:#d7ffd7; font-size:14px;}

  /* CHAT AI */
  .chatBox{
    height:320px;
    overflow:auto;
    padding:14px;
    border-radius:18px;
    border:1px solid rgba(0,255,68,.25);
    background:#050505;
    margin-top:10px;
    line-height:1.5;
  }
  .chatLine{
    margin-bottom:10px;
    font-weight:700;
  }
  .ai{color:#00ff44;}
  .user{color:#caffff;}
  .sys{color:#ffcc66;}

  .inputRow{
    display:flex;
    gap:10px;
    margin-top:10px;
  }
  .inputRow input{
    flex:1;
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(0,255,68,.25);
    background:#070707;
    color:var(--text);
    outline:none;
  }

  /* GAME CANVAS */
  .gameWrap{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
  }
  canvas{
    background:linear-gradient(#020202,#0a0a0a);
    border-radius:18px;
    border:2px solid rgba(0,255,68,.35);
    box-shadow:var(--shadow2);
  }

  .hud{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    justify-content:center;
    font-weight:900;
    color:var(--green);
    text-shadow:0 0 10px rgba(0,255,68,.5);
  }

  /* MOBILE JOYSTICK */
  .joystick{
    width:150px;height:150px;
    border-radius:50%;
    border:2px solid rgba(0,255,68,.3);
    background:rgba(0,255,68,.08);
    position:relative;
    display:none;
    margin-top:10px;
    box-shadow:var(--shadow);
  }
  .stick{
    width:55px;height:55px;
    border-radius:50%;
    background:rgba(0,255,68,.7);
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%,-50%);
    box-shadow:0 0 18px rgba(0,255,68,.6);
  }

  @media(max-width:800px){
    .joystick{display:block;}
  }

  /* STORE */
  .storeGrid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:14px;
    margin-top:14px;
  }
  .storeItem{
    padding:14px;
    border-radius:18px;
    border:1px solid rgba(0,255,68,.25);
    background:rgba(0,255,68,.05);
  }
  .storeItem h3{color:var(--green); margin-bottom:6px;}
  .storeItem p{color:#d7ffd7; font-size:14px;}
</style>
</head>

<body>

<div id="preloader">
  <div class="loaderCircle"></div>
  <p>MR7 WORLD LOADING...</p>
</div>

<canvas id="particles"></canvas>

<header>
  <div class="brand">
    <div class="logo">MR7</div>
    <div>
      <div class="brandTitle">MR7 WORLD <span class="verified">‚úî Verified</span></div>
      <div style="font-size:12px;color:#bfffbf;">Gaming + AI + Cool Features</div>
    </div>
  </div>

  <div class="status">
    <div id="statusDot" class="dot"></div>
    <span id="statusText">Online</span>
  </div>

  <button class="menuBtn" onclick="toggleMenu()">‚ãÆ</button>
</header>

<div id="menuPanel">
  <h2>MR7 Menu</h2>
  <input class="searchBox" id="searchInput" placeholder="Search page (home, ai, car, snake, shooter, store)..." />

  <button class="menuItem" onclick="openPage('home')">üè† Home</button>
  <button class="menuItem" onclick="openPage('ai')">ü§ñ MR7 AI Chat</button>
  <button class="menuItem" onclick="openPage('car')">üöó Car Racing</button>
  <button class="menuItem" onclick="openPage('snake')">üêç Snake Game</button>
  <button class="menuItem" onclick="openPage('shooter')">üöÄ Space Shooter</button>
  <button class="menuItem" onclick="openPage('store')">üõí MR7 Store</button>
  <button class="menuItem" onclick="openPage('settings')">‚öô Settings</button>

  <button class="closeMenu" onclick="toggleMenu()">Close</button>
</div>

<div id="popup">
  <h3>Welcome Boss üòé</h3>
  <p>Welcome to MR7 WORLD - Enjoy Gaming + AI üî•</p>
</div>

<div class="container">

  <!-- HOME -->
  <div class="page active" id="home">
    <div class="card">
      <h1>üî• Welcome to MR7 WORLD</h1>
      <p>This is your official gaming + AI website. Clean design, fast performance, premium neon UI.</p>

      <div class="btnRow">
        <button class="btn" onclick="openPage('ai')">Open MR7 AI</button>
        <button class="btn dark" onclick="openPage('car')">Play Car Racing</button>
        <button class="btn dark" onclick="openPage('snake')">Play Snake</button>
        <button class="btn dark" onclick="openPage('shooter')">Play Space Shooter</button>
      </div>
    </div>

    <div class="card">
      <h2>üëë Profile Card</h2>
      <div class="profile">
        <div class="profilePic">MR7</div>
        <div>
          <h3 style="color:var(--green);text-shadow:0 0 10px rgba(0,255,68,.5);">MD REHAN <span style="color:#caffca;">‚úî Verified</span></h3>
          <p>Official Gaming + AI Creator üöÄ</p>

          <div class="socialLinks">
            <a href="https://instagram.com" target="_blank">Instagram</a>
            <a href="https://youtube.com" target="_blank">YouTube</a>
            <a href="https://wa.me/91" target="_blank">WhatsApp</a>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üèÜ Achievements</h2>
      <p id="achievementsText">Loading achievements...</p>
    </div>
  </div>

  <!-- AI -->
  <div class="page" id="ai">
    <div class="card">
      <h2>ü§ñ MR7 AI Chat</h2>
      <p>Real ChatGPT API Powered (Paste API Key below)</p>

      <input id="apiKey" class="searchBox" placeholder="Paste OpenAI API Key (sk-...)" />

      <div class="chatBox" id="chatBox"></div>

      <div class="inputRow">
        <input id="userInput" placeholder="Type message... (Enter = send)" />
        <button class="btn" onclick="sendMessage()">Send</button>
        <button class="btn dark" onclick="clearChat()">Clear</button>
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>
    </div>
  </div>

  <!-- CAR GAME -->
  <div class="page" id="car">
    <div class="card">
      <h2>üöó MR7 Car Racing</h2>
      <div class="hud">
        <div>Score: <span id="carScore">0</span></div>
        <div>HighScore: <span id="carHigh">0</span></div>
        <div>Speed: <span id="carSpeed">5</span></div>
        <div>Nitro: <span id="carNitro">100</span>%</div>
      </div>

      <div class="btnRow" style="justify-content:center;">
        <button class="btn" onclick="startCarGame()">Start Game</button>
        <button class="btn dark" onclick="boostNitro()">üî• Nitro Boost</button>
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>

      <div class="gameWrap">
        <canvas id="carCanvas" width="420" height="560"></canvas>

        <div class="joystick" id="joy">
          <div class="stick" id="stick"></div>
        </div>

        <p style="text-align:center;color:#caffca;margin-top:6px;">
          Controls: Arrow Keys / A-D (PC) | Joystick (Mobile) | Nitro button üî•
        </p>
      </div>
    </div>
  </div>

  <!-- SNAKE -->
  <div class="page" id="snake">
    <div class="card">
      <h2>üêç MR7 Snake Game</h2>
      <div class="hud">
        <div>Score: <span id="snakeScore">0</span></div>
        <div>HighScore: <span id="snakeHigh">0</span></div>
      </div>

      <div class="btnRow" style="justify-content:center;">
        <button class="btn" onclick="startSnake()">Start Game</button>
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>

      <div class="gameWrap">
        <canvas id="snakeCanvas" width="420" height="420"></canvas>
        <p style="text-align:center;color:#caffca;margin-top:6px;">
          Controls: Arrow Keys / Swipe (Mobile)
        </p>
      </div>
    </div>
  </div>

  <!-- SHOOTER -->
  <div class="page" id="shooter">
    <div class="card">
      <h2>üöÄ Space Shooter</h2>
      <div class="hud">
        <div>Score: <span id="shootScore">0</span></div>
        <div>HighScore: <span id="shootHigh">0</span></div>
      </div>

      <div class="btnRow" style="justify-content:center;">
        <button class="btn" onclick="startShooter()">Start Game</button>
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>

      <div class="gameWrap">
        <canvas id="shootCanvas" width="420" height="520"></canvas>
        <p style="text-align:center;color:#caffca;margin-top:6px;">
          Controls: Arrow Keys + Space to Shoot
        </p>
      </div>
    </div>
  </div>

  <!-- STORE -->
  <div class="page" id="store">
    <div class="card">
      <h2>üõí MR7 Store</h2>
      <p>Coins: <b id="coinsText">0</b> ü™ô</p>

      <div class="storeGrid">
        <div class="storeItem">
          <h3>üöó Red Car Skin</h3>
          <p>Price: 100 coins</p>
          <button class="btn" onclick="buyItem('redcar',100)">Buy</button>
        </div>

        <div class="storeItem">
          <h3>üêç Neon Snake Skin</h3>
          <p>Price: 150 coins</p>
          <button class="btn" onclick="buyItem('neonsnake',150)">Buy</button>
        </div>

        <div class="storeItem">
          <h3>üöÄ Space Ship Upgrade</h3>
          <p>Price: 200 coins</p>
          <button class="btn" onclick="buyItem('ship',200)">Buy</button>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="page" id="settings">
    <div class="card">
      <h2>‚öô Settings</h2>
      <p>Customize MR7 WORLD</p>

      <div class="btnRow">
        <button class="btn dark" onclick="toggleSound()">üîä Sound: <span id="soundText">OFF</span></button>
        <button class="btn dark" onclick="resetData()">üßπ Reset Data</button>
        <button class="btn dark" onclick="openPage('home')">Back</button>
      </div>
    </div>
  </div>

</div>

<button class="fullscreenBtn" onclick="toggleFullscreen()">üì± Fullscreen</button>

<script>
/* ---------------- PRELOADER ---------------- */
window.onload = () => {
  setTimeout(() => {
    document.getElementById("preloader").style.display="none";
    showPopup();
    initParticles();
    updateOnlineStatus();
    loadStats();
    initAI();
  }, 1200);
};

/* ---------------- POPUP ---------------- */
function showPopup(){
  let popup=document.getElementById("popup");
  popup.classList.add("show");
  setTimeout(()=>popup.classList.remove("show"), 4000);
}

/* ---------------- ONLINE STATUS ---------------- */
function updateOnlineStatus(){
  const dot=document.getElementById("statusDot");
  const text=document.getElementById("statusText");
  if(navigator.onLine){
    dot.classList.remove("off");
    text.innerText="Online";
  }else{
    dot.classList.add("off");
    text.innerText="Offline";
  }
}
window.addEventListener("online", updateOnlineStatus);
window.addEventListener("offline", updateOnlineStatus);

/* ---------------- MENU ---------------- */
function toggleMenu(){
  document.getElementById("menuPanel").classList.toggle("active");
}
document.getElementById("searchInput").addEventListener("input", function(){
  let q=this.value.toLowerCase();
  if(q.includes("home")) openPage("home");
  if(q.includes("ai")) openPage("ai");
  if(q.includes("car")) openPage("car");
  if(q.includes("snake")) openPage("snake");
  if(q.includes("shoot")) openPage("shooter");
  if(q.includes("store")) openPage("store");
  if(q.includes("setting")) openPage("settings");
});

/* ---------------- PAGE SYSTEM ---------------- */
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("menuPanel").classList.remove("active");
}

/* ---------------- FULLSCREEN ---------------- */
function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

/* ---------------- SOUND SYSTEM (NO ANNOYING WAAA) ---------------- */
let soundOn = localStorage.getItem("mr7_sound") === "true";
document.getElementById("soundText").innerText = soundOn ? "ON" : "OFF";

function toggleSound(){
  soundOn = !soundOn;
  localStorage.setItem("mr7_sound", soundOn);
  document.getElementById("soundText").innerText = soundOn ? "ON" : "OFF";
  showPopup();
}

/* ---------------- DATA ---------------- */
let coins = parseInt(localStorage.getItem("mr7_coins") || "0");
function updateCoins(){
  document.getElementById("coinsText").innerText = coins;
  localStorage.setItem("mr7_coins", coins);
}
updateCoins();

function resetData(){
  if(confirm("Reset all MR7 WORLD data?")){
    localStorage.clear();
    location.reload();
  }
}

/* ---------------- ACHIEVEMENTS ---------------- */
function loadStats(){
  let carHigh = parseInt(localStorage.getItem("carHigh") || "0");
  let snakeHigh = parseInt(localStorage.getItem("snakeHigh") || "0");
  let shootHigh = parseInt(localStorage.getItem("shootHigh") || "0");

  let ach = [];
  if(carHigh >= 10) ach.push("üèé Car Beginner");
  if(carHigh >= 50) ach.push("üî• Car Pro");
  if(snakeHigh >= 10) ach.push("üêç Snake Starter");
  if(snakeHigh >= 30) ach.push("‚ö° Snake Master");
  if(shootHigh >= 20) ach.push("üöÄ Shooter Rookie");
  if(shootHigh >= 80) ach.push("üí• Space Legend");

  document.getElementById("achievementsText").innerText =
    ach.length ? ach.join(" | ") : "No achievements unlocked yet. Play games to unlock üéñ";
}

/* ---------------- STORE ---------------- */
function buyItem(name, price){
  if(coins < price){
    alert("Not enough coins!");
    return;
  }
  coins -= price;
  localStorage.setItem("item_"+name, "true");
  updateCoins();
  alert("Purchased successfully!");
}

/* ===========================================================
   PARTICLES BACKGROUND (NEW STYLE)
=========================================================== */
function initParticles(){
  const canvas = document.getElementById("particles");
  const ctx = canvas.getContext("2d");

  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);

  let particles = [];
  for(let i=0;i<90;i++){
    particles.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: Math.random()*2+1,
      vx: (Math.random()-0.5)*0.7,
      vy: (Math.random()-0.5)*0.7
    });
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    particles.forEach(p=>{
      p.x += p.vx;
      p.y += p.vy;

      if(p.x<0||p.x>canvas.width) p.vx*=-1;
      if(p.y<0||p.y>canvas.height) p.vy*=-1;

      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle="rgba(0,255,68,.6)";
      ctx.fill();
    });

    requestAnimationFrame(animate);
  }
  animate();
}

/* ===========================================================
   MR7 AI CHAT (REAL API + ENTER SEND)
=========================================================== */
let chatHistory = [];

function initAI(){
  const saved = localStorage.getItem("mr7_chat_history");
  if(saved){
    chatHistory = JSON.parse(saved);
  }else{
    chatHistory = [
      {role:"assistant", content:"Hello Boss üòé Ask me anything! (Hinglish only)"}
    ];
  }
  renderChat();

  document.getElementById("userInput").addEventListener("keydown", function(e){
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      sendMessage();
    }
  });
}

function renderChat(){
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  chatHistory.forEach(m=>{
    let div=document.createElement("div");
    div.className="chatLine";
    if(m.role==="assistant") div.innerHTML = `<span class="ai">AI:</span> ${m.content}`;
    else div.innerHTML = `<span class="user">You:</span> ${m.content}`;
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

function clearChat(){
  chatHistory = [{role:"assistant", content:"Hello Boss üòé Ask me anything! (Hinglish only)"}];
  localStorage.setItem("mr7_chat_history", JSON.stringify(chatHistory));
  renderChat();
}

async function sendMessage(){
  const input = document.getElementById("userInput");
  const apiKey = document.getElementById("apiKey").value.trim();

  let msg = input.value.trim();
  if(!msg) return;

  chatHistory.push({role:"user", content:msg});
  input.value="";
  renderChat();

  if(!apiKey){
    chatHistory.push({role:"assistant", content:"Boss please paste OpenAI API key (sk-...) to enable real ChatGPT power."});
    renderChat();
    return;
  }

  chatHistory.push({role:"assistant", content:"Typing..."});
  renderChat();

  try{
    const response = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer " + apiKey
      },
      body: JSON.stringify({
        model:"gpt-4o-mini",
        messages:[
          {role:"system", content:"You are MR7 AI. You must reply only in Hinglish (no Hindi script). Be fast, helpful, friendly."},
          ...chatHistory.filter(x=>x.content!=="Typing...")
        ],
        temperature:0.7
      })
    });

    const data = await response.json();
    chatHistory = chatHistory.filter(x=>x.content!=="Typing...");

    if(data.error){
      chatHistory.push({role:"assistant", content:"API Error: " + data.error.message});
    }else{
      chatHistory.push({role:"assistant", content:data.choices[0].message.content});
    }

  }catch(err){
    chatHistory = chatHistory.filter(x=>x.content!=="Typing...");
    chatHistory.push({role:"assistant", content:"Network error. Please check internet / API key."});
  }

  localStorage.setItem("mr7_chat_history", JSON.stringify(chatHistory));
  renderChat();
}

/* ===========================================================
   CAR GAME (REAL CAR + STEERING + NITRO + JOYSTICK)
=========================================================== */
const carCanvas = document.getElementById("carCanvas");
const carCtx = carCanvas.getContext("2d");

let carGameRunning=false;
let carX=190, carY=460;
let carSpeed=5;
let carScore=0;
let nitro=100;
let obstacles=[];
let steer=0;
let carHigh = parseInt(localStorage.getItem("carHigh") || "0");

document.getElementById("carHigh").innerText = carHigh;

function drawCar(){
  // CAR BODY
  carCtx.fillStyle="rgba(0,255,68,.9)";
  carCtx.shadowColor="rgba(0,255,68,.6)";
  carCtx.shadowBlur=18;
  carCtx.fillRect(carX, carY, 40, 70);

  // WINDOWS
  carCtx.shadowBlur=0;
  carCtx.fillStyle="rgba(0,0,0,.8)";
  carCtx.fillRect(carX+7, carY+12, 26, 20);

  // LIGHTS
  carCtx.fillStyle="yellow";
  carCtx.fillRect(carX+5, carY+60, 8, 8);
  carCtx.fillRect(carX+27, carY+60, 8, 8);

  // WHEELS
  carCtx.fillStyle="#111";
  carCtx.fillRect(carX-6, carY+10, 6, 18);
  carCtx.fillRect(carX+40, carY+10, 6, 18);
  carCtx.fillRect(carX-6, carY+42, 6, 18);
  carCtx.fillRect(carX+40, carY+42, 6, 18);
}

function drawRoad(){
  carCtx.fillStyle="#111";
  carCtx.fillRect(0,0,carCanvas.width,carCanvas.height);

  carCtx.strokeStyle="rgba(0,255,68,.25)";
  carCtx.lineWidth=3;
  carCtx.strokeRect(10,10,carCanvas.width-20,carCanvas.height-20);

  // center dashed line
  carCtx.strokeStyle="rgba(255,255,255,.15)";
  carCtx.lineWidth=4;
  for(let y=0;y<carCanvas.height;y+=40){
    carCtx.beginPath();
    carCtx.moveTo(carCanvas.width/2, y);
    carCtx.lineTo(carCanvas.width/2, y+20);
    carCtx.stroke();
  }
}

function spawnObstacle(){
  obstacles.push({
    x:Math.random()*(carCanvas.width-60)+20,
    y:-60,
    w:40,
    h:60
  });
}

function startCarGame(){
  carGameRunning=true;
  carX=190; carScore=0;
  obstacles=[];
  carSpeed=5;
  nitro=100;
  document.getElementById("carSpeed").innerText=carSpeed;
  loopCar();
}

function boostNitro(){
  if(nitro>10){
    carSpeed += 2;
    nitro -= 15;
    if(carSpeed>14) carSpeed=14;
  }
}

function loopCar(){
  if(!carGameRunning) return;

  drawRoad();

  // move car
  carX += steer * 6;
  if(carX<20) carX=20;
  if(carX>carCanvas.width-60) carX=carCanvas.width-60;

  drawCar();

  // obstacles
  if(Math.random()<0.03) spawnObstacle();

  for(let i=0;i<obstacles.length;i++){
    let o=obstacles[i];
    o.y += carSpeed;

    carCtx.fillStyle="red";
    carCtx.shadowColor="rgba(255,0,0,.6)";
    carCtx.shadowBlur=15;
    carCtx.fillRect(o.x,o.y,o.w,o.h);
    carCtx.shadowBlur=0;

    // collision
    if(carX < o.x+o.w && carX+40 > o.x && carY < o.y+o.h && carY+70 > o.y){
      carGameRunning=false;
      alert("Game Over! Score: "+carScore);
      if(carScore>carHigh){
        carHigh=carScore;
        localStorage.setItem("carHigh",carHigh);
        document.getElementById("carHigh").innerText=carHigh;
      }
      coins += Math.floor(carScore/2);
      updateCoins();
      loadStats();
      return;
    }
  }

  obstacles = obstacles.filter(o=>o.y<carCanvas.height+80);

  carScore++;
  nitro -= 0.2;
  if(nitro<0) nitro=0;

  document.getElementById("carScore").innerText=carScore;
  document.getElementById("carSpeed").innerText=carSpeed;
  document.getElementById("carNitro").innerText=Math.floor(nitro);

  requestAnimationFrame(loopCar);
}

document.addEventListener("keydown",(e)=>{
  if(e.key==="ArrowLeft" || e.key==="a") steer=-1;
  if(e.key==="ArrowRight" || e.key==="d") steer=1;
});
document.addEventListener("keyup",(e)=>{
  if(["ArrowLeft","ArrowRight","a","d"].includes(e.key)) steer=0;
});

/* MOBILE JOYSTICK */
const joy=document.getElementById("joy");
const stick=document.getElementById("stick");
let joyActive=false;

joy.addEventListener("touchstart",(e)=>{
  joyActive=true;
});
joy.addEventListener("touchmove",(e)=>{
  if(!joyActive) return;
  let rect=joy.getBoundingClientRect();
  let touch=e.touches[0];
  let x=touch.clientX - rect.left - rect.width/2;

  if(x<-20) steer=-1;
  else if(x>20) steer=1;
  else steer=0;

  stick.style.left = (rect.width/2 + x/2) + "px";
});
joy.addEventListener("touchend",()=>{
  joyActive=false;
  steer=0;
  stick.style.left="50%";
});

/* ===========================================================
   SNAKE GAME (FIXED - SNAKE VISIBLE)
=========================================================== */
const snakeCanvas = document.getElementById("snakeCanvas");
const sctx = snakeCanvas.getContext("2d");

let snakeRunning=false;
let snake=[{x:200,y:200}];
let food={x:100,y:100};
let dir={x:20,y:0};
let snakeScore=0;
let snakeHigh=parseInt(localStorage.getItem("snakeHigh")||"0");
document.getElementById("snakeHigh").innerText=snakeHigh;

function startSnake(){
  snakeRunning=true;
  snake=[{x:200,y:200}];
  dir={x:20,y:0};
  snakeScore=0;
  spawnFood();
  loopSnake();
}

function spawnFood(){
  food.x=Math.floor(Math.random()*21)*20;
  food.y=Math.floor(Math.random()*21)*20;
}

function loopSnake(){
  if(!snakeRunning) return;

  sctx.clearRect(0,0,snakeCanvas.width,snakeCanvas.height);

  // grid glow
  sctx.strokeStyle="rgba(0,255,68,.08)";
  for(let i=0;i<snakeCanvas.width;i+=20){
    sctx.beginPath();
    sctx.moveTo(i,0);
    sctx.lineTo(i,snakeCanvas.height);
    sctx.stroke();
  }
  for(let j=0;j<snakeCanvas.height;j+=20){
    sctx.beginPath();
    sctx.moveTo(0,j);
    sctx.lineTo(snakeCanvas.width,j);
    sctx.stroke();
  }

  // move snake
  let head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};

  // wall collision
  if(head.x<0 || head.y<0 || head.x>=snakeCanvas.width || head.y>=snakeCanvas.height){
    endSnake();
    return;
  }

  // self collision
  for(let part of snake){
    if(head.x===part.x && head.y===part.y){
      endSnake();
      return;
    }
  }

  snake.unshift(head);

  // eat food
  if(head.x===food.x && head.y===food.y){
    snakeScore+=5;
    coins += 2;
    updateCoins();
    spawnFood();
  }else{
    snake.pop();
  }

  // draw food
  sctx.fillStyle="red";
  sctx.shadowColor="rgba(255,0,0,.6)";
  sctx.shadowBlur=18;
  sctx.fillRect(food.x,food.y,20,20);
  sctx.shadowBlur=0;

  // draw snake
  snake.forEach((p,i)=>{
    sctx.fillStyle = i===0 ? "#00ff44" : "rgba(0,255,68,.7)";
    sctx.shadowColor="rgba(0,255,68,.6)";
    sctx.shadowBlur=12;
    sctx.fillRect(p.x,p.y,20,20);
  });
  sctx.shadowBlur=0;

  document.getElementById("snakeScore").innerText=snakeScore;

  setTimeout(loopSnake, 100);
}

function endSnake(){
  snakeRunning=false;
  alert("Snake Game Over! Score: "+snakeScore);
  if(snakeScore>snakeHigh){
    snakeHigh=snakeScore;
    localStorage.setItem("snakeHigh",snakeHigh);
    document.getElementById("snakeHigh").innerText=snakeHigh;
  }
  loadStats();
}

document.addEventListener("keydown",(e)=>{
  if(!snakeRunning) return;
  if(e.key==="ArrowUp" && dir.y===0) dir={x:0,y:-20};
  if(e.key==="ArrowDown" && dir.y===0) dir={x:0,y:20};
  if(e.key==="ArrowLeft" && dir.x===0) dir={x:-20,y:0};
  if(e.key==="ArrowRight" && dir.x===0) dir={x:20,y:0};
});

/* ===========================================================
   SPACE SHOOTER GAME (NEW)
=========================================================== */
const shootCanvas=document.getElementById("shootCanvas");
const shctx=shootCanvas.getContext("2d");

let shootRunning=false;
let ship={x:200,y:460,w:40,h:40};
let bullets=[];
let enemies=[];
let shootScore=0;
let shootHigh=parseInt(localStorage.getItem("shootHigh")||"0");
document.getElementById("shootHigh").innerText=shootHigh;

function startShooter(){
  shootRunning=true;
  ship.x=200;
  bullets=[];
  enemies=[];
  shootScore=0;
  loopShooter();
}

function spawnEnemy(){
  enemies.push({
    x:Math.random()*(shootCanvas.width-40),
    y:-40,
    w:35,
    h:35
  });
}

function loopShooter(){
  if(!shootRunning) return;

  shctx.clearRect(0,0,shootCanvas.width,shootCanvas.height);

  // background stars
  for(let i=0;i<25;i++){
    shctx.fillStyle="rgba(255,255,255,.15)";
    shctx.fillRect(Math.random()*shootCanvas.width, Math.random()*shootCanvas.height,2,2);
  }

  // ship
  shctx.fillStyle="#00ff44";
  shctx.shadowColor="rgba(0,255,68,.6)";
  shctx.shadowBlur=18;
  shctx.fillRect(ship.x,ship.y,ship.w,ship.h);
  shctx.shadowBlur=0;

  // bullets
  bullets.forEach(b=>{
    b.y -= 10;
    shctx.fillStyle="yellow";
    shctx.fillRect(b.x,b.y,4,10);
  });
  bullets = bullets.filter(b=>b.y>-20);

  // enemies
  if(Math.random()<0.04) spawnEnemy();
  enemies.forEach(en=>{
    en.y += 4;
    shctx.fillStyle="red";
    shctx.shadowColor="rgba(255,0,0,.6)";
    shctx.shadowBlur=15;
    shctx.fillRect(en.x,en.y,en.w,en.h);
    shctx.shadowBlur=0;

    // collision with ship
    if(ship.x < en.x+en.w && ship.x+ship.w > en.x && ship.y < en.y+en.h && ship.y+ship.h > en.y){
      shootRunning=false;
      alert("Shooter Game Over! Score: "+shootScore);
      if(shootScore>shootHigh){
        shootHigh=shootScore;
        localStorage.setItem("shootHigh",shootHigh);
        document.getElementById("shootHigh").innerText=shootHigh;
      }
      coins += Math.floor(shootScore/2);
      updateCoins();
      loadStats();
      return;
    }
  });

  // bullet hit enemy
  bullets.forEach((b,bi)=>{
    enemies.forEach((en,ei)=>{
      if(b.x < en.x+en.w && b.x+4 > en.x && b.y < en.y+en.h && b.y+10 > en.y){
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        shootScore += 5;
      }
    });
  });

  enemies = enemies.filter(e=>e.y<shootCanvas.height+50);

  document.getElementById("shootScore").innerText=shootScore;

  requestAnimationFrame(loopShooter);
}

document.addEventListener("keydown",(e)=>{
  if(!shootRunning) return;
  if(e.key==="ArrowLeft") ship.x -= 18;
  if(e.key==="ArrowRight") ship.x += 18;
  if(e.key===" "){
    bullets.push({x:ship.x+ship.w/2, y:ship.y});
  }
  if(ship.x<0) ship.x=0;
  if(ship.x>shootCanvas.width-ship.w) ship.x=shootCanvas.width-ship.w;
});
</script>

</body>
</html>
