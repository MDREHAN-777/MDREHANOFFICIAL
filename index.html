<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MR7 - OFFICIAL</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:Segoe UI, Arial;
  background:#070707;
  color:white;
  text-align:center;
  overflow-x:hidden;
  padding:15px;
}
#preloader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:99999;
}
.loader-ring{
  width:90px;height:90px;
  border-radius:50%;
  border:7px solid rgba(0,255,0,0.15);
  border-top:7px solid lime;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#preloader h2{
  margin-top:18px;
  color:lime;
  text-shadow:0 0 12px lime;
}

#particles{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  z-index:-2;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:-3;
  background:radial-gradient(circle at top, rgba(0,255,0,.14), transparent 60%),
             radial-gradient(circle at bottom, rgba(0,120,255,.14), transparent 55%);
}

body.light{
  background:#fff;
  color:#111;
}

.dark-toggle{
  position:fixed;
  top:15px;
  right:15px;
  padding:10px 18px;
  border:none;
  border-radius:30px;
  background:lime;
  color:black;
  font-weight:bold;
  cursor:pointer;
  z-index:999;
}

.dots{
  position:fixed;
  top:15px;
  left:15px;
  width:45px;
  height:45px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  background:rgba(0,255,0,0.2);
  color:lime;
  font-size:25px;
  font-weight:bold;
  z-index:999;
  border:1px solid lime;
  box-shadow:0 0 15px rgba(0,255,0,0.4);
}
.dots-menu{
  position:fixed;
  top:70px;
  left:15px;
  width:220px;
  padding:10px;
  border-radius:15px;
  background:rgba(0,0,0,0.88);
  border:1px solid lime;
  display:none;
  z-index:999;
  backdrop-filter:blur(12px);
}
.dots-menu button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#222;
  color:white;
  font-weight:bold;
  transition:.25s;
}
.dots-menu button:hover{
  background:lime;
  color:black;
  transform:scale(1.05);
}

.section{display:none;animation:zoomIn .35s ease;}
.section.active{display:block;}
@keyframes zoomIn{
  from{opacity:0;transform:scale(0.95) translateY(15px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}

.box{
  max-width:650px;
  margin:25px auto;
  padding:20px;
  border-radius:22px;
  background:rgba(0,0,0,.62);
  border:1px solid rgba(0,255,0,.7);
  box-shadow:0 0 25px rgba(0,255,0,.25);
  backdrop-filter:blur(10px);
}
body.light .box{
  background:rgba(255,255,255,.95);
  color:black;
}

#typingTitle{
  font-size:34px;
  font-weight:bold;
  color:lime;
  margin-top:30px;
  text-shadow:0 0 15px lime;
}

.profile-pic{
  width:190px;
  height:190px;
  border-radius:50%;
  border:5px solid lime;
  box-shadow:0 0 30px lime;
  margin-top:15px;
  object-fit:cover;
}

.btn{
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  background:lime;
  font-weight:bold;
  color:black;
  transition:0.25s;
}
.btn:hover{
  transform:scale(1.08);
  box-shadow:0 0 20px lime;
}
.back-btn{
  margin-top:15px;
  background:#333;
  color:white;
}

input,textarea{
  width:95%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #777;
  outline:none;
}
textarea{height:100px;}

.menu-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
  margin-top:15px;
}

#chat{
  height:340px;
  overflow-y:auto;
  background:rgba(0,0,0,0.75);
  border-radius:18px;
  padding:12px;
  text-align:left;
  border:1px solid lime;
}
.user{
  background:rgba(0,255,120,0.18);
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  color:#7CFFB0;
  font-weight:700;
  border-left:4px solid lime;
}
.bot{
  background:rgba(0,140,255,0.18);
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  color:#7fd3ff;
  font-weight:700;
  border-left:4px solid cyan;
}
#chat::-webkit-scrollbar{width:8px;}
#chat::-webkit-scrollbar-thumb{background:lime;border-radius:10px;}
#chat::-webkit-scrollbar-track{background:#111;}

.game-title{
  font-size:24px;
  color:lime;
  text-shadow:0 0 12px lime;
}
canvas{
  background:#000;
  border-radius:18px;
  border:2px solid lime;
  max-width:100%;
  touch-action:none;
  margin-top:12px;
}
.scoreBox{
  display:flex;
  justify-content:space-between;
  gap:10px;
  margin-top:10px;
  font-weight:bold;
  color:lime;
}

#tttModeBox{margin-top:10px;}

@media(max-width:600px){
  #typingTitle{font-size:26px;}
  .profile-pic{width:150px;height:150px;}
}
</style>
</head>

<body>

<canvas id="particles"></canvas>

<div id="preloader">
  <div class="loader-ring"></div>
  <h2>Loading MR7 WORLD...</h2>
</div>

<button class="dots" onclick="toggleDots()">‚ãÆ</button>
<div class="dots-menu" id="dotsMenu">
  <button onclick="openSection('mainMenu'); closeDots()">üè† Home</button>
  <button onclick="openSection('aiPage'); closeDots()">ü§ñ MR7 AI</button>
  <button onclick="openSection('gamesPage'); closeDots()">üéÆ Games</button>
  <button onclick="openSection('helpPage'); closeDots()">üì© Help</button>
  <button onclick="logoutUser()">üö™ Logout</button>
</div>

<button class="dark-toggle" onclick="toggleMode()">üåô Mode</button>

<!-- LOGIN -->
<div id="loginPage" class="section active">
  <div class="box">
    <h2>üîê Login Required</h2>
    <p style="margin-top:8px;color:lime;">Login karo tabhi MR7 WORLD open hoga üî•</p>

    <input id="loginEmail" placeholder="Enter Email">
    <input id="loginPassword" type="password" placeholder="Enter Password">

    <button class="btn" onclick="loginUser()">Login</button>

    <p id="loginStatus" style="margin-top:10px;font-weight:bold;"></p>
  </div>
</div>

<!-- MAIN MENU -->
<div id="mainMenu" class="section">
  <h1 id="typingTitle"></h1>

  <div style="margin-top:5px;">
    <h2 style="color:white;">MR7 WORLD</h2>
    <h3 style="color:lime;text-shadow:0 0 10px lime;">‚úî VERIFIED</h3>
  </div>

  <a href="https://www.youtube.com/@MR7OFFICIAL777" target="_blank">
    <button class="btn">üî• SUBSCRIBE</button>
  </a>

  <p style="margin-top:5px;">üëÜ CLICK HERE ‚òù</p>

  <img src="rehan.png" class="profile-pic" alt="MR7 Logo">

  <div class="box">
    <h2 style="color:lime;">üî• MR7 WORLD Updates</h2>
    <p style="margin-top:8px;">
      Welcome Boss üòéüî• MR7 WORLD is now updated with REAL games + smart AI!
    </p>
  </div>

  <div class="box">
    <h2 style="color:lime;">üöÄ Features</h2>
    <div class="menu-grid">
      <button class="btn" onclick="openSection('aiPage')">ü§ñ MR7 AI</button>
      <button class="btn" onclick="openSection('gamesPage')">üéÆ Games</button>
      <button class="btn" onclick="openSection('helpPage')">üì© Help</button>
    </div>
  </div>
</div>

<!-- AI PAGE -->
<div id="aiPage" class="section">
  <div class="box">
    <h2 style="color:lime;">ü§ñ MR7 AI (Smart Mode)</h2>
    <p style="opacity:.8;margin-top:6px;">Hinglish + Smart Answer üòé</p>

    <div id="chat"></div>

    <input id="aiInput" placeholder="Ask anything..." />
    <button class="btn" onclick="askAI()">Send</button>
    <button class="btn" onclick="clearChat()">Clear</button>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back</button>
</div>

<!-- GAMES PAGE -->
<div id="gamesPage" class="section">
  <div class="box">
    <h2 style="color:lime;">üéÆ MR7 Games Zone</h2>
    <p style="opacity:.85;margin-top:6px;">Choose any game (full page mode)</p>

    <div class="menu-grid">
      <button class="btn" onclick="launchGame('snake')">üêç Snake Ultra</button>
      <button class="btn" onclick="launchGame('car')">üöó Car Racing Real</button>
      <button class="btn" onclick="launchGame('space')">üöÄ Space Shooter Ultra</button>
      <button class="btn" onclick="launchGame('ttt')">‚ùå‚≠ï Tic Tac Toe VS AI</button>
      <button class="btn" onclick="launchGame('runner')">üèÉ Endless Runner NEW</button>
    </div>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back Menu</button>
</div>

<!-- GAME PAGE -->
<div id="gamePage" class="section">
  <div class="box">
    <h2 class="game-title" id="gameTitle">Game</h2>

    <div class="scoreBox">
      <div id="scoreText">Score: 0</div>
      <div id="highScoreText">HighScore: 0</div>
    </div>

    <canvas id="gameCanvas" width="360" height="460"></canvas>

    <div id="tttModeBox" style="display:none;">
      <button class="btn" onclick="setTTTMode('single')">ü§ñ Single Player</button>
      <button class="btn" onclick="setTTTMode('multi')">üë• 2 Player</button>
    </div>

    <div style="margin-top:12px;">
      <button class="btn" onclick="startCurrentGame()">‚ñ∂ Start</button>
      <button class="btn" onclick="resetCurrentGame()">üîÅ Reset</button>
    </div>

    <div style="margin-top:12px;">
      <button class="btn back-btn" onclick="backToGames()">‚¨Ö Back to Games</button>
    </div>
  </div>
</div>

<!-- HELP -->
<div id="helpPage" class="section">
  <div class="box">
    <h2 style="color:lime;">üì© Help / Contact</h2>
    <input id="name" placeholder="Name">
    <input id="mobile" placeholder="Mobile">
    <textarea id="message" placeholder="Message"></textarea>
    <button class="btn" onclick="sendMail()">Send Email</button>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back</button>
</div>

<script>
/* ===========================
   PRELOADER
=========================== */
window.addEventListener("load", ()=>{
  setTimeout(()=>{
    document.getElementById("preloader").style.display="none";
  },600);
});

/* ===========================
   PARTICLES
=========================== */
const pCanvas = document.getElementById("particles");
const pCtx = pCanvas.getContext("2d");
let particles=[];
function resizeParticles(){
  pCanvas.width=window.innerWidth;
  pCanvas.height=window.innerHeight;
}
resizeParticles();
window.addEventListener("resize", resizeParticles);

function createParticles(){
  particles=[];
  let count = Math.floor((window.innerWidth*window.innerHeight)/18000);
  for(let i=0;i<count;i++){
    particles.push({
      x:Math.random()*pCanvas.width,
      y:Math.random()*pCanvas.height,
      r:Math.random()*2+1,
      dx:(Math.random()-0.5)*0.7,
      dy:(Math.random()-0.5)*0.7
    });
  }
}
createParticles();

function drawParticles(){
  pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);
  pCtx.fillStyle="rgba(0,255,0,0.35)";
  particles.forEach(p=>{
    pCtx.beginPath();
    pCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
    pCtx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if(p.x<0) p.x=pCanvas.width;
    if(p.x>pCanvas.width) p.x=0;
    if(p.y<0) p.y=pCanvas.height;
    if(p.y>pCanvas.height) p.y=0;
  });
  requestAnimationFrame(drawParticles);
}
drawParticles();

/* ===========================
   DOTS MENU
=========================== */
function toggleDots(){
  let menu=document.getElementById("dotsMenu");
  menu.style.display = menu.style.display==="block" ? "none" : "block";
}
function closeDots(){
  document.getElementById("dotsMenu").style.display="none";
}
document.addEventListener("click",(e)=>{
  if(!e.target.classList.contains("dots") && !e.target.closest("#dotsMenu")){
    closeDots();
  }
});

/* ===========================
   SECTIONS
=========================== */
function openSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===========================
   TITLE
=========================== */
function startTypingTitle(){
  let text="- MR7 WORLD -";
  let i=0;
  let el=document.getElementById("typingTitle");
  el.innerHTML="";
  let t=setInterval(()=>{
    el.innerHTML += text.charAt(i);
    i++;
    if(i>=text.length) clearInterval(t);
  },120);
}

/* ===========================
   MODE
=========================== */
function applyMode(){
  let mode = localStorage.getItem("mode") || "dark";
  if(mode==="light") document.body.classList.add("light");
  else document.body.classList.remove("light");
}
applyMode();

function toggleMode(){
  if(document.body.classList.contains("light")){
    document.body.classList.remove("light");
    localStorage.setItem("mode","dark");
  }else{
    document.body.classList.add("light");
    localStorage.setItem("mode","light");
  }
}

/* ===========================
   LOGIN
=========================== */
function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
}
function loginUser(){
  let email=document.getElementById("loginEmail").value.trim();
  let pass=document.getElementById("loginPassword").value.trim();
  let status=document.getElementById("loginStatus");

  if(!email || !pass){
    status.style.color="red";
    status.innerText="‚ùå Email aur Password fill karo!";
    return;
  }
  if(!isValidEmail(email)){
    status.style.color="red";
    status.innerText="‚ùå Wrong Email!";
    return;
  }
  if(pass.length < 4){
    status.style.color="red";
    status.innerText="‚ùå Password minimum 4 characters!";
    return;
  }

  localStorage.setItem("mr7Login","true");
  localStorage.setItem("mr7Email",email);

  status.style.color="lime";
  status.innerText="‚úÖ Login Successful!";

  setTimeout(()=>{
    openSection("mainMenu");
    startTypingTitle();
  },500);
}
function logoutUser(){
  localStorage.removeItem("mr7Login");
  localStorage.removeItem("mr7Email");
  closeDots();
  openSection("loginPage");
}
window.onload=()=>{
  let logged = localStorage.getItem("mr7Login");
  if(logged==="true"){
    openSection("mainMenu");
    startTypingTitle();
  }else{
    openSection("loginPage");
  }
};

/* ===========================
   EMAIL
=========================== */
function sendMail(){
  let n=document.getElementById("name").value.trim();
  let m=document.getElementById("mobile").value.trim();
  let msg=document.getElementById("message").value.trim();

  if(!n || !msg){
    alert("Please enter Name and Message üòÖ");
    return;
  }

  let subject = encodeURIComponent("MR7 Help from " + n);
  let body = encodeURIComponent("Name: " + n + "\nMobile: " + m + "\n\nMessage:\n" + msg);

  location.href="mailto:mrrehanofficial.1777@gmail.com?subject="+subject+"&body="+body;
}

/* ===========================
   AI SYSTEM (UPGRADED REAL)
=========================== */
let chat=document.getElementById("chat");
let aiInput=document.getElementById("aiInput");

function addMsg(text,cls){
  let div=document.createElement("div");
  div.className=cls;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function botReply(text){
  let div=document.createElement("div");
  div.className="bot";
  div.innerText="AI: typing...";
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;

  let i=0;
  let finalText="AI: " + text;
  let interval=setInterval(()=>{
    div.innerText = finalText.substring(0,i);
    i++;
    chat.scrollTop=chat.scrollHeight;
    if(i>finalText.length){
      clearInterval(interval);
    }
  },15);
}

/* WEATHER SYSTEM (FAKE BUT REALISTIC) */
function getWeatherFake(city){
  let temps=[22,24,26,28,30,32,34,36];
  let conditions=["Sunny ‚òÄÔ∏è","Cloudy ‚òÅÔ∏è","Rainy üåßÔ∏è","Storm üå©Ô∏è","Foggy üå´Ô∏è","Windy üå¨Ô∏è"];
  let temp=temps[Math.floor(Math.random()*temps.length)];
  let cond=conditions[Math.floor(Math.random()*conditions.length)];
  return `Boss ${city} ka weather abhi approx: ${temp}¬∞C | Condition: ${cond}\n\n(Real live weather ke liye API chahiye, but user ko idea mil jayega üòé)`;
}

function smartAI(q){
  let text=q.toLowerCase().trim();
  let userName = localStorage.getItem("mr7_userName") || "Boss";

  if(text.startsWith("my name is")){
    let nm = q.split("is")[1].trim();
    if(nm.length>1){
      localStorage.setItem("mr7_userName", nm);
      return `Okay boss üòé ab se main tumhe "${nm}" bolunga üî•`;
    }
  }

  if(text.includes("hello")||text.includes("hi")||text.includes("hey"))
    return `Hello ${userName} üòéüî• MR7 AI online mode me ready hai!`;

  if(text.includes("who are you")||text.includes("tum kaun ho"))
    return "Main MR7 AI hoon boss ü§ñüî• Main coding, gaming, youtube, study sab me help kar sakta hoon.";

  if(text.includes("time"))
    return "Boss current time: " + new Date().toLocaleTimeString() + " ‚è∞";

  if(text.includes("date"))
    return "Boss aaj ki date: " + new Date().toLocaleDateString() + " üìÖ";

  /* WEATHER IMPROVED */
  if(text.includes("weather")){
    let city="tumhare area";
    let words=q.split(" ");
    if(words.length>=2){
      city = words[words.length-1];
    }
    return getWeatherFake(city);
  }

  if(text.includes("python")){
    return "Boss Python ka roadmap:\n1) variables + input\n2) if else\n3) loops\n4) list/tuple/dict\n5) functions\n6) projects (calculator, game, website)\n\nDaily 1 project = pro ban jaoge üòéüî•";
  }

  if(text.includes("javascript")||text.includes("js")){
    return "Boss JavaScript se tum web ka KING ban sakte ho üòéüî• DOM + events + API + localStorage seekho, phir React start karo.";
  }

  if(text.includes("html")||text.includes("css")){
    return "Boss HTML structure hai, CSS design hai. Tum responsive layout + flexbox + grid master kar lo, website premium lagega üî•";
  }

  if(text.includes("how to earn")||text.includes("pais")||text.includes("earning")){
    return "Boss earning ideas:\n‚úÖ Website making\n‚úÖ YouTube Shorts\n‚úÖ Instagram Reels\n‚úÖ Freelancing (Fiverr/Upwork)\n‚úÖ Game website ads\n\nSkill strong karo, earning automatic aayega üòéüî•";
  }

  if(text.includes("motivation")){
    return "Boss yaad rakhna: duniya me 90% log quit kar dete hai. Tum quit nahi karoge to tum winner ho üòéüî•";

  if(text.includes("joke")){
    return "Boss ek joke üò≠:\nTeacher: Homework kyu nahi kiya?\nStudent: Sir internet down tha...\nTeacher: To notebook me kyu nahi likha? üòÇüî•";
  }

  if(text.includes("calc")){
    try{
      let exp=text.replace("calc","").trim();
      let result=eval(exp);
      return "Boss result: " + result + " üòé";
    }catch{
      return "Boss calculator error üò≠ Example: calc 50+20";
    }
  }

  /* BEST GENERAL ANSWER */
  return `Boss tumne bola: "${q}" üòé\n\nIska smart answer ye hai:\nüëâ Agar tum kisi bhi cheez me master banna chahte ho, pehle basics strong karo, phir daily practice karo.\n\nAgar tum detail doge main aur perfect answer dunga üî•`;
}

function askAI(){
  let q=aiInput.value.trim();
  if(!q) return;
  addMsg("You: "+q,"user");
  aiInput.value="";

  setTimeout(()=>{
    let reply=smartAI(q);
    botReply(reply);
  },200);
}
aiInput.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){
    e.preventDefault();
    askAI();
  }
});
function clearChat(){ chat.innerHTML=""; }

/* ===========================
   GAME SYSTEM
=========================== */
const gameCanvas = document.getElementById("gameCanvas");
const gctx = gameCanvas.getContext("2d");

let currentGame="";
let gameLoop=null;
let score=0;
let highScore=0;

function setScore(s){
  score=s;
  document.getElementById("scoreText").innerText="Score: "+score;
}
function setHighScore(h){
  highScore=h;
  document.getElementById("highScoreText").innerText="HighScore: "+highScore;
}
function loadHighScore(){
  let key="mr7_highscore_"+currentGame;
  let hs=parseInt(localStorage.getItem(key)||"0");
  setHighScore(hs);
}
function saveHighScore(){
  let key="mr7_highscore_"+currentGame;
  if(score>highScore){
    localStorage.setItem(key,score);
    setHighScore(score);
  }
}
function stopCurrentGame(){
  if(gameLoop){
    clearInterval(gameLoop);
    gameLoop=null;
  }
}

function launchGame(name){
  currentGame=name;
  stopCurrentGame();
  setScore(0);

  let titleMap={
    snake:"üêç Snake Ultra",
    car:"üöó Car Racing Real",
    space:"üöÄ Space Shooter Ultra",
    ttt:"‚ùå‚≠ï Tic Tac Toe",
    runner:"üèÉ Endless Runner"
  };

  document.getElementById("gameTitle").innerText=titleMap[name]||"Game";
  document.getElementById("tttModeBox").style.display=(name==="ttt")?"block":"none";

  openSection("gamePage");
  loadHighScore();
  resetCurrentGame();
}

function backToGames(){
  stopCurrentGame();
  openSection("gamesPage");
}

function startCurrentGame(){
  stopCurrentGame();
  if(currentGame==="snake") gameLoop=setInterval(moveSnake, snakeSpeed);
  if(currentGame==="space") gameLoop=setInterval(updateSpace, 30);
  if(currentGame==="car") gameLoop=setInterval(updateCar, 30);
  if(currentGame==="runner") gameLoop=setInterval(updateRunner, 30);
  if(currentGame==="ttt") drawTTT();
}

function resetCurrentGame(){
  stopCurrentGame();
  setScore(0);
  loadHighScore();

  if(currentGame==="snake"){resetSnake();drawSnake();}
  if(currentGame==="space"){resetSpace();drawSpace();}
  if(currentGame==="car"){resetCar();drawCar();}
  if(currentGame==="runner"){resetRunner();drawRunner();}
  if(currentGame==="ttt"){resetTTT();}
}

/* ===========================
   SNAKE
=========================== */
let snake=[],food={},snakeDir="RIGHT",snakeSpeed=110;
function resetSnake(){
  snake=[{x:160,y:240},{x:140,y:240},{x:120,y:240}];
  snakeDir="RIGHT";
  snakeSpeed=110;
  food={x:Math.floor(Math.random()*18)*20, y:Math.floor(Math.random()*20)*20};
}
function drawSnake(){
  gctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);
  gctx.fillStyle="#050505";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  gctx.strokeStyle="rgba(0,255,0,0.08)";
  for(let i=0;i<gameCanvas.width;i+=20){
    gctx.beginPath();
    gctx.moveTo(i,0);
    gctx.lineTo(i,gameCanvas.height);
    gctx.stroke();
  }
  for(let j=0;j<gameCanvas.height;j+=20){
    gctx.beginPath();
    gctx.moveTo(0,j);
    gctx.lineTo(gameCanvas.width,j);
    gctx.stroke();
  }

  gctx.shadowColor="red";
  gctx.shadowBlur=18;
  gctx.fillStyle="red";
  gctx.beginPath();
  gctx.arc(food.x+10,food.y+10,9,0,Math.PI*2);
  gctx.fill();
  gctx.shadowBlur=0;

  snake.forEach((p,index)=>{
    gctx.shadowColor="lime";
    gctx.shadowBlur=index===0?22:10;
    gctx.fillStyle=index===0?"#00ff66":"lime";
    gctx.beginPath();
    gctx.roundRect(p.x,p.y,20,20,8);
    gctx.fill();

    if(index===0){
      gctx.shadowBlur=0;
      gctx.fillStyle="black";
      gctx.beginPath();
      gctx.arc(p.x+6,p.y+7,2,0,Math.PI*2);
      gctx.arc(p.x+14,p.y+7,2,0,Math.PI*2);
      gctx.fill();
    }
  });
  gctx.shadowBlur=0;
}
function moveSnake(){
  let head={...snake[0]};
  if(snakeDir==="RIGHT") head.x+=20;
  if(snakeDir==="LEFT") head.x-=20;
  if(snakeDir==="UP") head.y-=20;
  if(snakeDir==="DOWN") head.y+=20;

  if(head.x<0||head.y<0||head.x>=gameCanvas.width||head.y>=gameCanvas.height){
    stopCurrentGame(); saveHighScore();
    alert("Game Over Boss üò≠");
    return;
  }

  for(let i=1;i<snake.length;i++){
    if(snake[i].x===head.x && snake[i].y===head.y){
      stopCurrentGame(); saveHighScore();
      alert("Game Over Boss üò≠");
      return;
    }
  }

  snake.unshift(head);

  if(head.x===food.x && head.y===food.y){
    setScore(score+10);
    if(score % 50 === 0 && snakeSpeed > 55){
      snakeSpeed -= 8;
      stopCurrentGame();
      gameLoop=setInterval(moveSnake, snakeSpeed);
    }
    food={
      x:Math.floor(Math.random()*(gameCanvas.width/20))*20,
      y:Math.floor(Math.random()*(gameCanvas.height/20))*20
    };
  }else snake.pop();

  drawSnake();
}

/* ===========================
   SPACE SHOOTER
=========================== */
let ship={},bullets=[],enemiesSpace=[],stars=[];
function resetSpace(){
  ship={x:gameCanvas.width/2-20,y:gameCanvas.height-90,w:40,h:55,speed:6};
  bullets=[]; enemiesSpace=[]; stars=[];
  for(let i=0;i<100;i++){
    stars.push({x:Math.random()*gameCanvas.width,y:Math.random()*gameCanvas.height,s:Math.random()*2+1});
  }
}
function drawRocket(x,y){
  gctx.shadowColor="cyan";
  gctx.shadowBlur=18;
  gctx.fillStyle="#00ffaa";
  gctx.beginPath();
  gctx.moveTo(x+20,y);
  gctx.lineTo(x,y+55);
  gctx.lineTo(x+40,y+55);
  gctx.closePath();
  gctx.fill();
  gctx.shadowBlur=0;

  gctx.fillStyle="rgba(0,0,0,0.6)";
  gctx.beginPath();
  gctx.arc(x+20,y+25,7,0,Math.PI*2);
  gctx.fill();

  gctx.fillStyle="orange";
  gctx.beginPath();
  gctx.moveTo(x+15,y+55);
  gctx.lineTo(x+20,y+70);
  gctx.lineTo(x+25,y+55);
  gctx.closePath();
  gctx.fill();
}
function drawSpace(){
  gctx.fillStyle="#000";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  stars.forEach(st=>{
    gctx.fillStyle="rgba(255,255,255,0.7)";
    gctx.fillRect(st.x,st.y,st.s,st.s);
    st.y += st.s*1.2;
    if(st.y>gameCanvas.height){ st.y=0; st.x=Math.random()*gameCanvas.width; }
  });

  gctx.fillStyle="rgba(0,255,255,0.08)";
  gctx.beginPath(); gctx.arc(80,120,90,0,Math.PI*2); gctx.fill();

  gctx.fillStyle="rgba(255,0,255,0.06)";
  gctx.beginPath(); gctx.arc(280,200,110,0,Math.PI*2); gctx.fill();

  drawRocket(ship.x,ship.y);

  gctx.fillStyle="yellow";
  bullets.forEach(b=>{
    gctx.shadowColor="yellow";
    gctx.shadowBlur=10;
    gctx.fillRect(b.x,b.y,4,14);
  });
  gctx.shadowBlur=0;

  enemiesSpace.forEach(en=>{
    gctx.shadowColor="red";
    gctx.shadowBlur=15;
    gctx.fillStyle=en.type==="asteroid"?"gray":"red";
    gctx.beginPath();
    gctx.arc(en.x,en.y,en.r,0,Math.PI*2);
    gctx.fill();
  });
  gctx.shadowBlur=0;
}
function updateSpace(){
  if(Math.random()<0.06){
    let isAsteroid=Math.random()<0.7;
    enemiesSpace.push({
      x:Math.random()*(gameCanvas.width-50)+25,
      y:-40,
      speed:2+Math.random()*3,
      r:isAsteroid?(12+Math.random()*10):(10+Math.random()*8),
      type:isAsteroid?"asteroid":"enemy"
    });
  }

  bullets.forEach(b=>b.y-=9);
  bullets=bullets.filter(b=>b.y>-20);

  enemiesSpace.forEach(en=>en.y+=en.speed);
  enemiesSpace=enemiesSpace.filter(en=>en.y<gameCanvas.height+60);

  enemiesSpace.forEach((en,ei)=>{
    bullets.forEach((b,bi)=>{
      let dx=b.x-en.x, dy=b.y-en.y;
      if(Math.sqrt(dx*dx+dy*dy)<en.r+6){
        enemiesSpace.splice(ei,1);
        bullets.splice(bi,1);
        setScore(score+10);
      }
    });
  });

  enemiesSpace.forEach(en=>{
    let dx=(ship.x+20)-en.x, dy=(ship.y+25)-en.y;
    if(Math.sqrt(dx*dx+dy*dy)<en.r+22){
      stopCurrentGame(); saveHighScore();
      alert("üí• Rocket Destroyed Boss üò≠ Game Over!");
    }
  });

  drawSpace();
}

/* ===========================
   CAR RACING (FIXED REAL)
=========================== */
let carPlayer={}, roadLines=[], trafficCars=[], carSpeed=5;

function resetCar(){
  carPlayer={x:160,y:360,w:38,h:70};
  roadLines=[];
  trafficCars=[];
  carSpeed=5;
  for(let i=0;i<12;i++){
    roadLines.push({x:175,y:i*50});
  }
}

function drawCarSprite(x,y,color){
  gctx.shadowColor=color;
  gctx.shadowBlur=15;
  gctx.fillStyle=color;
  gctx.beginPath();
  gctx.roundRect(x,y,38,70,10);
  gctx.fill();

  gctx.shadowBlur=0;
  gctx.fillStyle="black";
  gctx.fillRect(x+6,y+10,26,18);

  gctx.fillStyle="white";
  gctx.fillRect(x+8,y+14,22,10);

  gctx.fillStyle="#222";
  gctx.fillRect(x+4,y+60,10,10);
  gctx.fillRect(x+24,y+60,10,10);
}

function drawCar(){
  gctx.fillStyle="#111";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  // road
  gctx.fillStyle="#222";
  gctx.fillRect(80,0,200,gameCanvas.height);

  // side grass
  gctx.fillStyle="#0a2";
  gctx.fillRect(0,0,80,gameCanvas.height);
  gctx.fillRect(280,0,80,gameCanvas.height);

  // lane lines
  gctx.fillStyle="white";
  roadLines.forEach(l=>{
    gctx.fillRect(l.x,l.y,8,30);
  });

  // traffic
  trafficCars.forEach(t=>{
    drawCarSprite(t.x,t.y,"red");
  });

  // player car
  drawCarSprite(carPlayer.x,carPlayer.y,"lime");
}

function updateCar(){
  // road move
  roadLines.forEach(l=>{
    l.y += carSpeed+3;
    if(l.y>gameCanvas.height) l.y=-30;
  });

  // spawn traffic
  if(Math.random()<0.04){
    let lanes=[100,160,220];
    trafficCars.push({
      x:lanes[Math.floor(Math.random()*lanes.length)],
      y:-80
    });
  }

  // move traffic
  trafficCars.forEach(t=> t.y += carSpeed+2);
  trafficCars = trafficCars.filter(t=>t.y < gameCanvas.height+100);

  // collision
  trafficCars.forEach(t=>{
    if(carPlayer.x < t.x+38 && carPlayer.x+38 > t.x &&
       carPlayer.y < t.y+70 && carPlayer.y+70 > t.y){
      stopCurrentGame();
      saveHighScore();
      alert("üöóüí• Crash Boss üò≠ Game Over!");
    }
  });

  // score
  setScore(score+1);

  // speed increase
  if(score % 200 === 0) carSpeed += 0.7;

  drawCar();
}

/* ===========================
   RUNNER GAME (NEW)
=========================== */
let runner={}, obstacles=[], groundY=400, gravity=0.8;

function resetRunner(){
  runner={x:70,y:groundY,w:40,h:55,vy:0,jumping:false};
  obstacles=[];
}

function drawRunner(){
  gctx.fillStyle="#000";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  // background stars
  gctx.fillStyle="rgba(255,255,255,0.4)";
  for(let i=0;i<40;i++){
    gctx.fillRect(Math.random()*gameCanvas.width, Math.random()*gameCanvas.height, 2, 2);
  }

  // ground
  gctx.fillStyle="#222";
  gctx.fillRect(0,groundY+55,gameCanvas.width,10);

  // runner
  gctx.shadowColor="lime";
  gctx.shadowBlur=15;
  gctx.fillStyle="lime";
  gctx.beginPath();
  gctx.roundRect(runner.x,runner.y,runner.w,runner.h,10);
  gctx.fill();
  gctx.shadowBlur=0;

  // obstacles
  obstacles.forEach(o=>{
    gctx.shadowColor="red";
    gctx.shadowBlur=15;
    gctx.fillStyle="red";
    gctx.fillRect(o.x,o.y,o.w,o.h);
  });
  gctx.shadowBlur=0;
}

function updateRunner(){
  // gravity
  runner.vy += gravity;
  runner.y += runner.vy;

  if(runner.y >= groundY){
    runner.y = groundY;
    runner.vy = 0;
    runner.jumping=false;
  }

  // spawn obstacles
  if(Math.random()<0.04){
    obstacles.push({x:gameCanvas.width+30,y:groundY+20,w:25,h:35});
  }

  // move obstacles
  obstacles.forEach(o=> o.x -= 6);
  obstacles = obstacles.filter(o=> o.x>-50);

  // collision
  obstacles.forEach(o=>{
    if(runner.x < o.x+o.w && runner.x+runner.w > o.x &&
       runner.y < o.y+o.h && runner.y+runner.h > o.y){
      stopCurrentGame();
      saveHighScore();
      alert("üèÉüí• You Lost Boss üò≠");
    }
  });

  setScore(score+1);
  drawRunner();
}

/* ===========================
   TIC TAC TOE
=========================== */
let tttCells=new Array(9).fill("");
let tttPlayer="X";
let tttMode="single";

function setTTTMode(mode){
  tttMode=mode;
  alert("Mode Selected: " + (mode==="single" ? "Single Player VS Robot ü§ñ" : "2 Player üë•"));
  resetTTT();
}
function resetTTT(){
  tttCells=new Array(9).fill("");
  tttPlayer="X";
  drawTTT();
}
function drawTTT(){
  gctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);
  gctx.fillStyle="#000";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  gctx.strokeStyle="lime";
  gctx.lineWidth=4;

  for(let i=1;i<3;i++){
    gctx.beginPath();
    gctx.moveTo(i*(gameCanvas.width/3),0);
    gctx.lineTo(i*(gameCanvas.width/3),gameCanvas.height);
    gctx.stroke();

    gctx.beginPath();
    gctx.moveTo(0,i*(gameCanvas.height/3));
    gctx.lineTo(gameCanvas.width,i*(gameCanvas.height/3));
    gctx.stroke();
  }

  for(let i=0;i<9;i++){
    let x=(i%3)*(gameCanvas.width/3);
    let y=Math.floor(i/3)*(gameCanvas.height/3);

    gctx.font="bold 85px Arial";
    gctx.textAlign="center";
    gctx.textBaseline="middle";

    if(tttCells[i]==="X"){
      gctx.fillStyle="lime";
      gctx.fillText("X", x+gameCanvas.width/6, y+gameCanvas.height/6);
    }
    if(tttCells[i]==="O"){
      gctx.fillStyle="cyan";
      gctx.fillText("O", x+gameCanvas.width/6, y+gameCanvas.height/6);
    }
  }

  gctx.fillStyle="yellow";
  gctx.font="bold 18px Arial";
  gctx.fillText("Turn: "+tttPlayer, gameCanvas.width/2, 25);
}

function tttWin(){
  let w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  return w.some(p=>{
    return tttCells[p[0]] && tttCells[p[0]]===tttCells[p[1]] && tttCells[p[1]]===tttCells[p[2]];
  });
}

function tttBestMove(){
  let winPatterns=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

  for(let p of winPatterns){
    let [a,b,c]=p;
    if(tttCells[a]==="O" && tttCells[b]==="O" && tttCells[c]==="") return c;
    if(tttCells[a]==="O" && tttCells[c]==="O" && tttCells[b]==="") return b;
    if(tttCells[b]==="O" && tttCells[c]==="O" && tttCells[a]==="") return a;
  }
  for(let p of winPatterns){
    let [a,b,c]=p;
    if(tttCells[a]==="X" && tttCells[b]==="X" && tttCells[c]==="") return c;
    if(tttCells[a]==="X" && tttCells[c]==="X" && tttCells[b]==="") return b;
    if(tttCells[b]==="X" && tttCells[c]==="X" && tttCells[a]==="") return a;
  }

  if(tttCells[4]==="") return 4;
  let corners=[0,2,6,8].filter(i=>tttCells[i]==="");
  if(corners.length>0) return corners[Math.floor(Math.random()*corners.length)];

  let empty=tttCells.map((v,i)=>v===""?i:null).filter(v=>v!==null);
  return empty[Math.floor(Math.random()*empty.length)];
}

gameCanvas.addEventListener("click",(e)=>{
  if(currentGame!=="ttt") return;

  const rect=gameCanvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const my=e.clientY-rect.top;

  let col=Math.floor(mx/(rect.width/3));
  let row=Math.floor(my/(rect.height/3));
  let idx=row*3+col;

  if(tttCells[idx] !== "") return;

  tttCells[idx]=tttPlayer;

  if(tttWin()){
    drawTTT();
    alert("Winner: "+tttPlayer+" üòéüî•");
    setScore(score+10);
    saveHighScore();
    return;
  }

  if(tttCells.every(c=>c!=="")){
    drawTTT();
    alert("Draw üò≠");
    return;
  }

  if(tttMode==="single"){
    tttPlayer="O";
    let move=tttBestMove();
    tttCells[move]="O";

    if(tttWin()){
      drawTTT();
      alert("Robot Won ü§ñüî•");
      saveHighScore();
      return;
    }

    if(tttCells.every(c=>c!=="")){
      drawTTT();
      alert("Draw üò≠");
      return;
    }

    tttPlayer="X";
  }else{
    tttPlayer = (tttPlayer==="X") ? "O" : "X";
  }

  drawTTT();
});

/* ===========================
   KEYBOARD CONTROLS
=========================== */
document.addEventListener("keydown",(e)=>{
  if(currentGame==="snake"){
    if(e.key==="ArrowUp" && snakeDir!=="DOWN") snakeDir="UP";
    if(e.key==="ArrowDown" && snakeDir!=="UP") snakeDir="DOWN";
    if(e.key==="ArrowLeft" && snakeDir!=="RIGHT") snakeDir="LEFT";
    if(e.key==="ArrowRight" && snakeDir!=="LEFT") snakeDir="RIGHT";
  }

  if(currentGame==="space"){
    if(e.key==="ArrowLeft") ship.x -= ship.speed;
    if(e.key==="ArrowRight") ship.x += ship.speed;
    if(e.key==="ArrowUp") ship.y -= ship.speed;
    if(e.key==="ArrowDown") ship.y += ship.speed;
    if(e.key===" "){
      bullets.push({x:ship.x+20, y:ship.y});
    }
    if(ship.x<0) ship.x=0;
    if(ship.x+ship.w>gameCanvas.width) ship.x=gameCanvas.width-ship.w;
  }

  if(currentGame==="car"){
    if(e.key==="ArrowLeft") carPlayer.x -= 20;
    if(e.key==="ArrowRight") carPlayer.x += 20;

    if(carPlayer.x<90) carPlayer.x=90;
    if(carPlayer.x>232) carPlayer.x=232;
  }

  if(currentGame==="runner"){
    if(e.key===" " || e.key==="ArrowUp"){
      if(!runner.jumping){
        runner.vy=-14;
        runner.jumping=true;
      }
    }
  }
});

/* ===========================
   STARTUP
=========================== */
openSection("loginPage");
</script>

</body>
</html>
