<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MR7 - OFFICIAL</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:Segoe UI, Arial;
  background:#0b0b0b;
  color:white;
  text-align:center;
  overflow-x:hidden;
  padding:15px;
}

/* PRELOADER */
#preloader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:99999;
}
.loader-ring{
  width:80px;height:80px;
  border-radius:50%;
  border:6px solid rgba(0,255,0,0.15);
  border-top:6px solid lime;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#preloader h2{
  margin-top:18px;
  color:lime;
  text-shadow:0 0 12px lime;
}

/* PARTICLES CANVAS */
#particles{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  z-index:-2;
}

/* BACKGROUND GLOW */
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:-3;
  background:radial-gradient(circle at top, rgba(0,255,0,.12), transparent 60%),
             radial-gradient(circle at bottom, rgba(0,120,255,.10), transparent 55%);
  filter:blur(0px);
}

body.light{
  background:#fff;
  color:#111;
}

/* TOP BUTTONS */
.dark-toggle{
  position:fixed;
  top:15px;
  right:15px;
  padding:10px 18px;
  border:none;
  border-radius:30px;
  background:lime;
  color:black;
  font-weight:bold;
  cursor:pointer;
  z-index:999;
}

/* 3 DOT MENU */
.dots{
  position:fixed;
  top:15px;
  left:15px;
  width:45px;
  height:45px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  background:rgba(0,255,0,0.2);
  color:lime;
  font-size:25px;
  font-weight:bold;
  z-index:999;
  border:1px solid lime;
  box-shadow:0 0 15px rgba(0,255,0,0.4);
}
.dots-menu{
  position:fixed;
  top:70px;
  left:15px;
  width:200px;
  padding:10px;
  border-radius:15px;
  background:rgba(0,0,0,0.85);
  border:1px solid lime;
  display:none;
  z-index:999;
  backdrop-filter:blur(10px);
}
.dots-menu button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#222;
  color:white;
  font-weight:bold;
  transition:.25s;
}
.dots-menu button:hover{
  background:lime;
  color:black;
  transform:scale(1.05);
}

/* SECTION TRANSITION */
.section{
  display:none;
  animation:zoomIn .35s ease;
}
.section.active{
  display:block;
}
@keyframes zoomIn{
  from{opacity:0;transform:scale(0.95) translateY(15px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}

/* BOX */
.box{
  max-width:560px;
  margin:25px auto;
  padding:20px;
  border-radius:20px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(0,255,0,.6);
  box-shadow:0 0 20px rgba(0,255,0,.25);
  backdrop-filter:blur(8px);
}
body.light .box{
  background:rgba(255,255,255,.95);
  color:black;
}

/* TITLE */
#typingTitle{
  font-size:34px;
  font-weight:bold;
  color:lime;
  margin-top:30px;
  text-shadow:0 0 15px lime;
}

/* PROFILE */
.profile-pic{
  width:190px;
  height:190px;
  border-radius:50%;
  border:5px solid lime;
  box-shadow:0 0 30px lime;
  margin-top:15px;
  object-fit:cover;
}

/* BUTTON */
.btn{
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  background:lime;
  font-weight:bold;
  color:black;
  transition:0.25s;
}
.btn:hover{
  transform:scale(1.08);
  box-shadow:0 0 20px lime;
}
.back-btn{
  margin-top:15px;
  background:#333;
  color:white;
}

/* INPUT */
input,textarea{
  width:95%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #777;
  outline:none;
}
textarea{height:100px;}

/* MENU GRID */
.menu-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
  margin-top:15px;
}

/* CHAT */
#chat{
  height:320px;
  overflow-y:auto;
  background:#000;
  border-radius:15px;
  padding:10px;
  text-align:left;
  border:1px solid lime;
}
.user{
  background:#00ff8833;
  padding:10px;
  margin:8px 0;
  border-radius:12px;
  color:lime;
  font-weight:600;
}
.bot{
  background:#0088ff33;
  padding:10px;
  margin:8px 0;
  border-radius:12px;
  color:#66ccff;
  font-weight:600;
}

/* GAME PAGE */
.game-title{
  font-size:24px;
  color:lime;
  text-shadow:0 0 12px lime;
}
canvas{
  background:#000;
  border-radius:18px;
  border:2px solid lime;
  max-width:100%;
  touch-action:none;
  margin-top:12px;
}

/* SCORE */
.scoreBox{
  display:flex;
  justify-content:space-between;
  gap:10px;
  margin-top:10px;
  font-weight:bold;
  color:lime;
}

/* MOBILE */
@media(max-width:600px){
  #typingTitle{font-size:26px;}
  .profile-pic{width:150px;height:150px;}
}
</style>
</head>

<body>

<canvas id="particles"></canvas>

<!-- PRELOADER -->
<div id="preloader">
  <div class="loader-ring"></div>
  <h2>Loading MR7 WORLD...</h2>
</div>

<!-- 3 DOT MENU -->
<button class="dots" onclick="toggleDots()">‚ãÆ</button>
<div class="dots-menu" id="dotsMenu">
  <button onclick="openSection('mainMenu'); closeDots()">üè† Home</button>
  <button onclick="openSection('aiPage'); closeDots()">ü§ñ MR7 AI</button>
  <button onclick="openSection('gamesPage'); closeDots()">üéÆ Games</button>
  <button onclick="openSection('helpPage'); closeDots()">üì© Help</button>
  <button onclick="logoutUser()">üö™ Logout</button>
</div>

<button class="dark-toggle" onclick="toggleMode()">üåô Mode</button>

<!-- LOGIN PAGE -->
<div id="loginPage" class="section active">
  <div class="box">
    <h2>üîê Login Required</h2>
    <p style="margin-top:8px;color:lime;">Login karo tabhi MR7 WORLD open hoga üî•</p>

    <input id="loginEmail" placeholder="Enter Email">
    <input id="loginPassword" type="password" placeholder="Enter Password">

    <button class="btn" onclick="loginUser()">Login</button>

    <p id="loginStatus" style="margin-top:10px;font-weight:bold;"></p>
  </div>
</div>

<!-- MAIN MENU -->
<div id="mainMenu" class="section">
  <h1 id="typingTitle"></h1>

  <div style="margin-top:5px;">
    <h2 style="color:white;">MD REHAN</h2>
    <h3 style="color:lime;text-shadow:0 0 10px lime;">‚úî VERIFIED</h3>
  </div>

  <a href="https://www.youtube.com/@MR7OFFICIAL777" target="_blank">
    <button class="btn">üî• SUBSCRIBE</button>
  </a>

  <p style="margin-top:5px;">üëÜ CLICK HERE ‚òù</p>

  <!-- PROFILE IMAGE -->
  <img src="rehan.png" class="profile-pic" alt="MR7 Logo">

  <div class="box">
    <h2 style="color:lime;">üî• MR7 WORLD Updates</h2>
    <p style="margin-top:8px;">
      Welcome Boss üòéüî• MR7 WORLD is ready!
    </p>
  </div>

  <div class="box">
    <h2 style="color:lime;">üöÄ Features</h2>
    <div class="menu-grid">
      <button class="btn" onclick="openSection('aiPage')">ü§ñ MR7 AI</button>
      <button class="btn" onclick="openSection('gamesPage')">üéÆ Games</button>
      <button class="btn" onclick="openSection('helpPage')">üì© Help</button>
    </div>
  </div>
</div>

<!-- AI PAGE -->
<div id="aiPage" class="section">
  <div class="box">
    <h2 style="color:lime;">ü§ñ MR7 AI (Next Level Offline)</h2>
    <p style="opacity:.8;margin-top:6px;">Hinglish only üòé</p>

    <div id="chat"></div>

    <input id="aiInput" placeholder="Ask anything..." />
    <button class="btn" onclick="askAI()">Send</button>
    <button class="btn" onclick="clearChat()">Clear</button>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back</button>
</div>

<!-- GAMES PAGE -->
<div id="gamesPage" class="section">
  <div class="box">
    <h2 style="color:lime;">üéÆ MR7 Games Zone</h2>
    <p style="opacity:.85;margin-top:6px;">Choose any game (full page mode)</p>

    <div class="menu-grid">
      <button class="btn" onclick="launchGame('snake')">üêç Snake Pro</button>
      <button class="btn" onclick="launchGame('car')">üöó Car Racing Pro</button>
      <button class="btn" onclick="launchGame('space')">üöÄ Space Shooter</button>
      <button class="btn" onclick="launchGame('ttt')">‚ùå‚≠ï Tic Tac Toe</button>
    </div>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back Menu</button>
</div>

<!-- GAME PLAY PAGE -->
<div id="gamePage" class="section">
  <div class="box">
    <h2 class="game-title" id="gameTitle">Game</h2>

    <div class="scoreBox">
      <div id="scoreText">Score: 0</div>
      <div id="highScoreText">HighScore: 0</div>
    </div>

    <canvas id="gameCanvas" width="360" height="460"></canvas>

    <div style="margin-top:12px;">
      <button class="btn" onclick="startCurrentGame()">‚ñ∂ Start</button>
      <button class="btn" onclick="stopCurrentGame()">‚è∏ Stop</button>
      <button class="btn" onclick="resetCurrentGame()">üîÅ Reset</button>
    </div>

    <div style="margin-top:12px;">
      <button class="btn back-btn" onclick="backToGames()">‚¨Ö Back to Games</button>
    </div>
  </div>
</div>

<!-- HELP PAGE -->
<div id="helpPage" class="section">
  <div class="box">
    <h2 style="color:lime;">üì© Help / Contact</h2>
    <input id="name" placeholder="Name">
    <input id="mobile" placeholder="Mobile">
    <textarea id="message" placeholder="Message"></textarea>
    <button class="btn" onclick="sendMail()">Send Email</button>
  </div>

  <button class="btn back-btn" onclick="openSection('mainMenu')">‚¨Ö Back</button>
</div>

<script>
/* ===========================
   PRELOADER
=========================== */
window.addEventListener("load", ()=>{
  setTimeout(()=>{
    document.getElementById("preloader").style.display="none";
  },800);
});

/* ===========================
   PARTICLES BACKGROUND
=========================== */
const pCanvas = document.getElementById("particles");
const pCtx = pCanvas.getContext("2d");

let particles=[];
function resizeParticles(){
  pCanvas.width=window.innerWidth;
  pCanvas.height=window.innerHeight;
}
resizeParticles();
window.addEventListener("resize", resizeParticles);

function createParticles(){
  particles=[];
  let count = Math.floor((window.innerWidth*window.innerHeight)/18000);
  for(let i=0;i<count;i++){
    particles.push({
      x:Math.random()*pCanvas.width,
      y:Math.random()*pCanvas.height,
      r:Math.random()*2+1,
      dx:(Math.random()-0.5)*0.6,
      dy:(Math.random()-0.5)*0.6
    });
  }
}
createParticles();

function drawParticles(){
  pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);

  pCtx.fillStyle="rgba(0,255,0,0.35)";
  particles.forEach(p=>{
    pCtx.beginPath();
    pCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
    pCtx.fill();

    p.x += p.dx;
    p.y += p.dy;

    if(p.x<0) p.x=pCanvas.width;
    if(p.x>pCanvas.width) p.x=0;
    if(p.y<0) p.y=pCanvas.height;
    if(p.y>pCanvas.height) p.y=0;
  });

  requestAnimationFrame(drawParticles);
}
drawParticles();

/* ===========================
   DOTS MENU
=========================== */
function toggleDots(){
  let menu=document.getElementById("dotsMenu");
  menu.style.display = menu.style.display==="block" ? "none" : "block";
}
function closeDots(){
  document.getElementById("dotsMenu").style.display="none";
}
document.addEventListener("click",(e)=>{
  if(!e.target.classList.contains("dots") && !e.target.closest("#dotsMenu")){
    closeDots();
  }
});

/* ===========================
   OPEN SECTION
=========================== */
function openSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===========================
   TYPING TITLE
=========================== */
function startTypingTitle(){
  let text="- MR7 WORLD -";
  let i=0;
  let el=document.getElementById("typingTitle");
  el.innerHTML="";
  let t=setInterval(()=>{
    el.innerHTML += text.charAt(i);
    i++;
    if(i>=text.length) clearInterval(t);
  },120);
}

/* ===========================
   DARK MODE SAVE
=========================== */
function applyMode(){
  let mode = localStorage.getItem("mode") || "dark";
  if(mode==="light") document.body.classList.add("light");
  else document.body.classList.remove("light");
}
applyMode();

function toggleMode(){
  if(document.body.classList.contains("light")){
    document.body.classList.remove("light");
    localStorage.setItem("mode","dark");
  }else{
    document.body.classList.add("light");
    localStorage.setItem("mode","light");
  }
}

/* ===========================
   EMAIL VALIDATION
=========================== */
function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
}

/* ===========================
   LOGIN SYSTEM
=========================== */
function loginUser(){
  let email=document.getElementById("loginEmail").value.trim();
  let pass=document.getElementById("loginPassword").value.trim();
  let status=document.getElementById("loginStatus");

  if(!email || !pass){
    status.style.color="red";
    status.innerText="‚ùå Email aur Password fill karo!";
    return;
  }

  if(!isValidEmail(email)){
    status.style.color="red";
    status.innerText="‚ùå Wrong Email! Sahi email dalo.";
    return;
  }

  if(pass.length < 4){
    status.style.color="red";
    status.innerText="‚ùå Password minimum 4 characters hona chahiye!";
    return;
  }

  localStorage.setItem("mr7Login","true");
  localStorage.setItem("mr7Email",email);

  status.style.color="lime";
  status.innerText="‚úÖ Login Successful!";

  setTimeout(()=>{
    openSection("mainMenu");
    startTypingTitle();
  },600);
}

function logoutUser(){
  localStorage.removeItem("mr7Login");
  localStorage.removeItem("mr7Email");
  closeDots();
  openSection("loginPage");
}

window.onload=()=>{
  let logged = localStorage.getItem("mr7Login");
  if(logged==="true"){
    openSection("mainMenu");
    startTypingTitle();
  }else{
    openSection("loginPage");
  }
};

/* ===========================
   CONTACT EMAIL
=========================== */
function sendMail(){
  let n=document.getElementById("name").value.trim();
  let m=document.getElementById("mobile").value.trim();
  let msg=document.getElementById("message").value.trim();

  if(!n || !msg){
    alert("Please enter Name and Message üòÖ");
    return;
  }

  let subject = encodeURIComponent("MR7 Help from " + n);
  let body = encodeURIComponent("Name: " + n + "\nMobile: " + m + "\n\nMessage:\n" + msg);

  location.href="mailto:mrrehanofficial.1777@gmail.com?subject="+subject+"&body="+body;
}

/* ===========================
   MR7 AI (SUPER UPGRADED)
=========================== */
let chat=document.getElementById("chat");
let aiInput=document.getElementById("aiInput");

function addMsg(text,cls){
  let div=document.createElement("div");
  div.className=cls;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function typingBot(text){
  let div=document.createElement("div");
  div.className="bot";
  div.innerText="AI: typing...";
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;

  setTimeout(()=>{
    div.innerText="AI: " + text;
    chat.scrollTop=chat.scrollHeight;
  }, 500);
}

function smartAI(q){
  let text=q.toLowerCase().trim();

  if(text.startsWith("calc")){
    try{
      let exp=text.replace("calc","").trim();
      let result=eval(exp);
      return "Boss result is: " + result + " üòé";
    }catch{
      return "Calculator error boss üò≠ Example: calc 50+20";
    }
  }

  if(text.includes("hello")||text.includes("hi")||text.includes("hey"))
    return "Hello boss üòéüî• MR7 AI ready hai!";

  if(text.includes("tum kaun ho")||text.includes("who are you"))
    return "Main MR7 AI hoon boss ü§ñüî• Main coding, gaming, youtube sab me help kar sakta hoon.";

  if(text.includes("time"))
    return "Boss time is: " + new Date().toLocaleTimeString();

  if(text.includes("date"))
    return "Boss date is: " + new Date().toLocaleDateString();

  if(text.includes("youtube"))
    return "Boss YouTube grow karna hai to: Shorts + consistency + good title + thumbnail + trending topic pakdo üî•";

  if(text.includes("python"))
    return "Python best hai boss üòé Automation, AI, web dev sab me. Tum loops, functions, list daily practice karo.";

  if(text.includes("html") || text.includes("css") || text.includes("javascript"))
    return "Boss web dev ke liye HTML structure strong karo, CSS animation use karo, JS logic practice karo. Projects banaate raho üî•";

  if(text.includes("game"))
    return "Boss game banana ho to canvas + collision + score + movement logic use hota hai üòé";

  if(text.includes("india"))
    return "Boss India is a country in South Asia. Capital is New Delhi üáÆüá≥";

  if(text.includes("world war 2"))
    return "Boss World War 2 started in 1939 and ended in 1945. Major countries were Germany, Japan, Italy vs Allies.";

  if(text.includes("elon musk"))
    return "Boss Elon Musk is a billionaire entrepreneur, CEO of Tesla and SpaceX.";

  if(text.includes("cricket"))
    return "Boss cricket me consistency + timing sabse important. Daily net practice karo üòé";

  if(text.includes("football"))
    return "Boss football improve karna hai to dribbling + stamina + first touch daily 30 min practice karo ‚öΩüî•";

  if(text.includes("motivation"))
    return "Boss remember one thing: discipline beats talent üòéüî•";

  // fallback
  return "Boss ye question interesting hai üòé but offline AI limited hai. Thoda aur detail do main best answer dunga!";
}

function askAI(){
  let q=aiInput.value.trim();
  if(!q) return;

  addMsg("You: "+q,"user");
  aiInput.value="";

  localStorage.setItem("mr7_last_question", q);

  setTimeout(()=>{
    let reply=smartAI(q);
    typingBot(reply);
  },200);
}

aiInput.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){
    e.preventDefault();
    askAI();
  }
});

function clearChat(){
  if(confirm("Clear full chat?")){
    chat.innerHTML="";
  }
}

/* ===========================
   GAME SYSTEM (FULL PAGE)
=========================== */
const gameCanvas = document.getElementById("gameCanvas");
const gctx = gameCanvas.getContext("2d");

let currentGame = "";
let gameLoop = null;
let score = 0;
let highScore = 0;

function setScore(s){
  score = s;
  document.getElementById("scoreText").innerText = "Score: " + score;
}

function setHighScore(h){
  highScore = h;
  document.getElementById("highScoreText").innerText = "HighScore: " + highScore;
}

function loadHighScore(){
  let key = "mr7_highscore_" + currentGame;
  let hs = parseInt(localStorage.getItem(key) || "0");
  setHighScore(hs);
}

function saveHighScore(){
  let key = "mr7_highscore_" + currentGame;
  if(score > highScore){
    localStorage.setItem(key, score);
    setHighScore(score);
  }
}

function launchGame(name){
  currentGame = name;
  stopCurrentGame();
  setScore(0);

  let titleMap = {
    snake: "üêç Snake Pro",
    car: "üöó Car Racing Pro",
    space: "üöÄ Space Shooter",
    ttt: "‚ùå‚≠ï Tic Tac Toe"
  };

  document.getElementById("gameTitle").innerText = titleMap[name] || "Game";
  openSection("gamePage");

  loadHighScore();
  resetCurrentGame();
}

function backToGames(){
  stopCurrentGame();
  openSection("gamesPage");
}

function stopCurrentGame(){
  if(gameLoop){
    clearInterval(gameLoop);
    gameLoop = null;
  }
}

/* ===========================
   SNAKE PRO GAME
=========================== */
let snake=[], food={}, snakeDir="RIGHT", snakeSpeed=120;

function resetSnake(){
  snake=[{x:140,y:240},{x:120,y:240},{x:100,y:240}];
  snakeDir="RIGHT";
  snakeSpeed=120;
  food={x:Math.floor(Math.random()*18)*20, y:Math.floor(Math.random()*20)*20};
}

function drawSnake(){
  gctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);

  // background
  gctx.fillStyle="#050505";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  // grid
  gctx.strokeStyle="rgba(0,255,0,0.07)";
  for(let i=0;i<gameCanvas.width;i+=20){
    gctx.beginPath();
    gctx.moveTo(i,0);
    gctx.lineTo(i,gameCanvas.height);
    gctx.stroke();
  }
  for(let j=0;j<gameCanvas.height;j+=20){
    gctx.beginPath();
    gctx.moveTo(0,j);
    gctx.lineTo(gameCanvas.width,j);
    gctx.stroke();
  }

  // food glow
  gctx.shadowColor="red";
  gctx.shadowBlur=15;
  gctx.fillStyle="red";
  gctx.fillRect(food.x,food.y,20,20);
  gctx.shadowBlur=0;

  // snake glow
  snake.forEach((p,index)=>{
    gctx.shadowColor="lime";
    gctx.shadowBlur=index===0?20:8;
    gctx.fillStyle=index===0?"#00ff55":"lime";
    gctx.fillRect(p.x,p.y,20,20);
  });
  gctx.shadowBlur=0;
}

function moveSnake(){
  let head={...snake[0]};
  if(snakeDir==="RIGHT") head.x+=20;
  if(snakeDir==="LEFT") head.x-=20;
  if(snakeDir==="UP") head.y-=20;
  if(snakeDir==="DOWN") head.y+=20;

  // wall hit
  if(head.x<0||head.y<0||head.x>=gameCanvas.width||head.y>=gameCanvas.height){
    stopCurrentGame();
    saveHighScore();
    alert("Game Over Boss üò≠");
    return;
  }

  // self hit
  for(let i=1;i<snake.length;i++){
    if(snake[i].x===head.x && snake[i].y===head.y){
      stopCurrentGame();
      saveHighScore();
      alert("Game Over Boss üò≠");
      return;
    }
  }

  snake.unshift(head);

  // eat food
  if(head.x===food.x && head.y===food.y){
    setScore(score+10);

    if(score % 50 === 0 && snakeSpeed > 60){
      snakeSpeed -= 10;
      stopCurrentGame();
      gameLoop=setInterval(moveSnake, snakeSpeed);
    }

    food={
      x:Math.floor(Math.random()*(gameCanvas.width/20))*20,
      y:Math.floor(Math.random()*(gameCanvas.height/20))*20
    };
  }else{
    snake.pop();
  }

  drawSnake();
}

/* ===========================
   CAR RACING PRO
=========================== */
let carPlayer={}, enemies=[], roadOffset=0, nitro=100;

function resetCar(){
  carPlayer={x:160,y:360,w:40,h:70,speed:4};
  enemies=[
    {x:80,y:-200,w:40,h:70,speed:4},
    {x:200,y:-500,w:40,h:70,speed:5}
  ];
  roadOffset=0;
  nitro=100;
}

function drawCarSprite(x,y,w,h,color){
  // body
  gctx.fillStyle=color;
  gctx.fillRect(x,y,w,h);

  // cabin
  gctx.fillStyle="#111";
  gctx.fillRect(x+6,y+12,w-12,20);

  // glass
  gctx.fillStyle="#66ccff";
  gctx.fillRect(x+9,y+14,w-18,16);

  // wheels
  gctx.fillStyle="#000";
  gctx.fillRect(x-6,y+10,8,18);
  gctx.fillRect(x+w-2,y+10,8,18);
  gctx.fillRect(x-6,y+h-28,8,18);
  gctx.fillRect(x+w-2,y+h-28,8,18);

  // lights
  gctx.fillStyle="yellow";
  gctx.fillRect(x+5,y+h-6,8,6);
  gctx.fillRect(x+w-13,y+h-6,8,6);
}

function drawCarGame(){
  gctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);

  // road
  gctx.fillStyle="#2b2b2b";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  // borders
  gctx.fillStyle="#111";
  gctx.fillRect(0,0,50,gameCanvas.height);
  gctx.fillRect(gameCanvas.width-50,0,50,gameCanvas.height);

  // lines
  gctx.strokeStyle="white";
  gctx.lineWidth=4;
  gctx.setLineDash([20,20]);
  gctx.beginPath();
  gctx.moveTo(gameCanvas.width/2, -roadOffset);
  gctx.lineTo(gameCanvas.width/2, gameCanvas.height);
  gctx.stroke();
  gctx.setLineDash([]);

  // nitro bar
  gctx.fillStyle="rgba(0,255,0,0.3)";
  gctx.fillRect(10,10,120,14);
  gctx.fillStyle="lime";
  gctx.fillRect(10,10,(nitro/100)*120,14);
  gctx.strokeStyle="lime";
  gctx.strokeRect(10,10,120,14);

  gctx.fillStyle="yellow";
  gctx.font="bold 16px Arial";
  gctx.fillText("Nitro", 140, 22);

  // player
  gctx.shadowColor="lime";
  gctx.shadowBlur=12;
  drawCarSprite(carPlayer.x,carPlayer.y,carPlayer.w,carPlayer.h,"lime");
  gctx.shadowBlur=0;

  // enemies
  enemies.forEach(e=>{
    drawCarSprite(e.x,e.y,e.w,e.h,"red");
  });
}

function updateCarGame(){
  roadOffset += 8;
  if(roadOffset>40) roadOffset=0;

  enemies.forEach(e=>{
    e.y += e.speed;

    // collision
    if(carPlayer.x < e.x+e.w &&
       carPlayer.x+carPlayer.w > e.x &&
       carPlayer.y < e.y+e.h &&
       carPlayer.y+carPlayer.h > e.y){
      stopCurrentGame();
      saveHighScore();
      alert("üí• Crash Boss! Game Over! Score: "+score);
    }

    // reset enemy
    if(e.y>gameCanvas.height+80){
      e.y = -Math.random()*300 - 150;
      e.x = 60 + Math.random()*(gameCanvas.width-140);
      setScore(score+5);
    }
  });

  // nitro regen
  if(nitro < 100) nitro += 0.2;

  drawCarGame();
}

/* ===========================
   SPACE SHOOTER
=========================== */
let ship={}, bullets=[], enemiesSpace=[], stars=[];

function resetSpace(){
  ship={x:gameCanvas.width/2-18,y:gameCanvas.height-80,w:36,h:50,speed:6};
  bullets=[];
  enemiesSpace=[];
  stars=[];
  for(let i=0;i<70;i++){
    stars.push({x:Math.random()*gameCanvas.width,y:Math.random()*gameCanvas.height,s:Math.random()*2+1});
  }
}

function drawSpace(){
  gctx.fillStyle="#000";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  // stars
  gctx.fillStyle="white";
  stars.forEach(st=>{
    gctx.globalAlpha=0.6;
    gctx.fillRect(st.x,st.y,st.s,st.s);
    st.y += st.s;
    if(st.y>gameCanvas.height){
      st.y=0; st.x=Math.random()*gameCanvas.width;
    }
  });
  gctx.globalAlpha=1;

  // ship
  gctx.shadowColor="lime";
  gctx.shadowBlur=15;
  gctx.fillStyle="lime";
  gctx.beginPath();
  gctx.moveTo(ship.x+ship.w/2, ship.y);
  gctx.lineTo(ship.x, ship.y+ship.h);
  gctx.lineTo(ship.x+ship.w, ship.y+ship.h);
  gctx.closePath();
  gctx.fill();
  gctx.shadowBlur=0;

  // bullets
  gctx.fillStyle="yellow";
  bullets.forEach(b=>{
    gctx.fillRect(b.x,b.y,4,12);
  });

  // enemies
  enemiesSpace.forEach(en=>{
    gctx.shadowColor="red";
    gctx.shadowBlur=10;
    gctx.fillStyle="red";
    gctx.fillRect(en.x,en.y,30,30);
    gctx.shadowBlur=0;
  });
}

function updateSpace(){
  // spawn enemies
  if(Math.random()<0.04){
    enemiesSpace.push({x:Math.random()*(gameCanvas.width-40)+10,y:-30,speed:2+Math.random()*2});
  }

  // bullets move
  bullets.forEach(b=> b.y -= 8);
  bullets = bullets.filter(b=>b.y>-20);

  // enemies move
  enemiesSpace.forEach(en=> en.y += en.speed);
  enemiesSpace = enemiesSpace.filter(en=>en.y<gameCanvas.height+50);

  // collision bullet-enemy
  enemiesSpace.forEach((en,ei)=>{
    bullets.forEach((b,bi)=>{
      if(b.x < en.x+30 && b.x+4 > en.x && b.y < en.y+30 && b.y+12 > en.y){
        enemiesSpace.splice(ei,1);
        bullets.splice(bi,1);
        setScore(score+10);
      }
    });
  });

  // collision ship-enemy
  enemiesSpace.forEach(en=>{
    if(ship.x < en.x+30 && ship.x+ship.w > en.x && ship.y < en.y+30 && ship.y+ship.h > en.y){
      stopCurrentGame();
      saveHighScore();
      alert("üöÄ Ship destroyed Boss üò≠ Game Over!");
    }
  });

  drawSpace();
}

/* ===========================
   TIC TAC TOE (Canvas simple)
=========================== */
let tttCells = new Array(9).fill("");
let tttPlayer = "X";

function resetTTT(){
  tttCells = new Array(9).fill("");
  tttPlayer = "X";
  drawTTT();
}

function drawTTT(){
  gctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);
  gctx.fillStyle="#000";
  gctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);

  gctx.strokeStyle="lime";
  gctx.lineWidth=4;

  // grid
  for(let i=1;i<3;i++){
    gctx.beginPath();
    gctx.moveTo(i*(gameCanvas.width/3),0);
    gctx.lineTo(i*(gameCanvas.width/3),gameCanvas.height);
    gctx.stroke();

    gctx.beginPath();
    gctx.moveTo(0,i*(gameCanvas.height/3));
    gctx.lineTo(gameCanvas.width,i*(gameCanvas.height/3));
    gctx.stroke();
  }

  // draw X O
  for(let i=0;i<9;i++){
    let x=(i%3)*(gameCanvas.width/3);
    let y=Math.floor(i/3)*(gameCanvas.height/3);

    gctx.font="bold 80px Arial";
    gctx.textAlign="center";
    gctx.textBaseline="middle";

    if(tttCells[i]==="X"){
      gctx.fillStyle="lime";
      gctx.fillText("X", x+gameCanvas.width/6, y+gameCanvas.height/6);
    }
    if(tttCells[i]==="O"){
      gctx.fillStyle="cyan";
      gctx.fillText("O", x+gameCanvas.width/6, y+gameCanvas.height/6);
    }
  }

  gctx.fillStyle="yellow";
  gctx.font="bold 18px Arial";
  gctx.fillText("Turn: "+tttPlayer, gameCanvas.width/2, 25);
}

function tttWin(){
  let w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  return w.some(p=>{
    return tttCells[p[0]] && tttCells[p[0]]===tttCells[p[1]] && tttCells[p[1]]===tttCells[p[2]];
  });
}

gameCanvas.addEventListener("click",(e)=>{
  if(currentGame!=="ttt") return;

  const rect = gameCanvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  let col = Math.floor(mx / (rect.width/3));
  let row = Math.floor(my / (rect.height/3));
  let idx = row*3 + col;

  if(tttCells[idx] !== "") return;

  tttCells[idx] = tttPlayer;

  if(tttWin()){
    drawTTT();
    alert("Winner: " + tttPlayer + " üòéüî•");
    setScore(score+10);
    saveHighScore();
    return;
  }

  if(tttCells.every(c=>c!=="")){
    drawTTT();
    alert("Draw üò≠");
    return;
  }

  tttPlayer = (tttPlayer==="X") ? "O" : "X";
  drawTTT();
});

/* ===========================
   GAME CONTROL
=========================== */
function startCurrentGame(){
  stopCurrentGame();

  if(currentGame==="snake"){
    gameLoop=setInterval(moveSnake, snakeSpeed);
  }
  else if(currentGame==="car"){
    gameLoop=setInterval(updateCarGame, 30);
  }
  else if(currentGame==="space"){
    gameLoop=setInterval(updateSpace, 30);
  }
  else if(currentGame==="ttt"){
    drawTTT();
  }
}

function resetCurrentGame(){
  stopCurrentGame();

  if(currentGame==="snake"){
    resetSnake();
    drawSnake();
  }
  else if(currentGame==="car"){
    resetCar();
    drawCarGame();
  }
  else if(currentGame==="space"){
    resetSpace();
    drawSpace();
  }
  else if(currentGame==="ttt"){
    resetTTT();
  }
}

function resetCurrentGameUI(){
  setScore(0);
  loadHighScore();
}

/* ===========================
   KEYBOARD CONTROLS
=========================== */
document.addEventListener("keydown",(e)=>{
  // Snake
  if(currentGame==="snake"){
    if(e.key==="ArrowUp" && snakeDir!=="DOWN") snakeDir="UP";
    if(e.key==="ArrowDown" && snakeDir!=="UP") snakeDir="DOWN";
    if(e.key==="ArrowLeft" && snakeDir!=="RIGHT") snakeDir="LEFT";
    if(e.key==="ArrowRight" && snakeDir!=="LEFT") snakeDir="RIGHT";
  }

  // Car
  if(currentGame==="car"){
    if(e.key==="ArrowLeft") carPlayer.x -= carPlayer.speed*4;
    if(e.key==="ArrowRight") carPlayer.x += carPlayer.speed*4;

    // Nitro boost
    if(e.key===" " && nitro>10){
      nitro -= 10;
      enemies.forEach(en=> en.y += 25);
    }

    if(carPlayer.x<55) carPlayer.x=55;
    if(carPlayer.x>gameCanvas.width-95) carPlayer.x=gameCanvas.width-95;
  }

  // Space
  if(currentGame==="space"){
    if(e.key==="ArrowLeft") ship.x -= ship.speed;
    if(e.key==="ArrowRight") ship.x += ship.speed;
    if(e.key==="ArrowUp") ship.y -= ship.speed;
    if(e.key==="ArrowDown") ship.y += ship.speed;

    if(e.key===" "){
      bullets.push({x:ship.x+ship.w/2-2, y:ship.y});
    }

    if(ship.x<0) ship.x=0;
    if(ship.x+ship.w>gameCanvas.width) ship.x=gameCanvas.width-ship.w;
    if(ship.y<0) ship.y=0;
    if(ship.y+ship.h>gameCanvas.height) ship.y=gameCanvas.height-ship.h;
  }
});

/* ===========================
   MOBILE TOUCH CONTROLS
=========================== */
let touchStartX=0, touchStartY=0;

gameCanvas.addEventListener("touchstart",(e)=>{
  let t=e.touches[0];
  touchStartX=t.clientX;
  touchStartY=t.clientY;
});

gameCanvas.addEventListener("touchmove",(e)=>{
  let t=e.touches[0];
  let dx=t.clientX-touchStartX;
  let dy=t.clientY-touchStartY;

  touchStartX=t.clientX;
  touchStartY=t.clientY;

  // Car move
  if(currentGame==="car"){
    carPlayer.x += dx*0.5;
    if(carPlayer.x<55) carPlayer.x=55;
    if(carPlayer.x>gameCanvas.width-95) carPlayer.x=gameCanvas.width-95;
  }

  // Space move
  if(currentGame==="space"){
    ship.x += dx*0.4;
    ship.y += dy*0.4;

    if(ship.x<0) ship.x=0;
    if(ship.x+ship.w>gameCanvas.width) ship.x=gameCanvas.width-ship.w;
    if(ship.y<0) ship.y=0;
    if(ship.y+ship.h>gameCanvas.height) ship.y=gameCanvas.height-ship.h;
  }
});

/* ===========================
   STOP / SAVE
=========================== */
function resetCurrentGame(){
  stopCurrentGame();
  setScore(0);
  loadHighScore();

  if(currentGame==="snake"){
    resetSnake(); drawSnake();
  }
  if(currentGame==="car"){
    resetCar(); drawCarGame();
  }
  if(currentGame==="space"){
    resetSpace(); drawSpace();
  }
  if(currentGame==="ttt"){
    resetTTT();
  }
}

/* ===========================
   STARTUP
=========================== */
openSection("loginPage");
</script>

</body>
</html>
