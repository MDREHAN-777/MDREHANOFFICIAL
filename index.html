<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MR7 Car Racing - Premium</title>

<style>
body{
  margin:0;
  background:black;
  font-family:Segoe UI, Arial;
  color:#00ff00;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}

h2{
  margin:10px;
  text-shadow:0 0 15px #00ff00;
}

#infoBox{
  margin-bottom:10px;
  padding:10px 18px;
  border:1px solid #00ff00;
  border-radius:12px;
  background:#111;
  box-shadow:0 0 15px #00ff00;
  font-size:15px;
}

canvas{
  background:#050505;
  border:2px solid #00ff00;
  border-radius:15px;
  box-shadow:0 0 25px #00ff00;
}

/* Start Button */
#startBtn{
  padding:12px 20px;
  border:none;
  border-radius:12px;
  background:#00ff00;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 0 15px #00ff00;
  margin-bottom:10px;
}

/* Mobile Controls */
.controls{
  margin-top:12px;
  display:flex;
  gap:10px;
}

.btn{
  width:90px;
  height:55px;
  border:none;
  border-radius:12px;
  font-size:18px;
  font-weight:bold;
  background:#00ff00;
  color:#000;
  cursor:pointer;
  box-shadow:0 0 15px #00ff00;
}
.btn:active{
  transform:scale(0.9);
}

@media(min-width:900px){
  .controls{display:none;}
}
</style>
</head>

<body>

<h2>ðŸš— MR7 Car Racing</h2>

<div id="infoBox">
Score: <span id="score">0</span> |
HighScore: <span id="high">0</span> |
Speed: <span id="speed">5</span>
</div>

<button id="startBtn" onclick="startGame()">Start Game</button>

<canvas id="road" width="420" height="520"></canvas>

<!-- Mobile Controls -->
<div class="controls">
  <button class="btn" ontouchstart="keys.left=true" ontouchend="keys.left=false">â¬… Left</button>
  <button class="btn" ontouchstart="keys.right=true" ontouchend="keys.right=false">Right âž¡</button>
  <button class="btn" ontouchstart="activateNitro()" ontouchend="deactivateNitro()">ðŸ”¥ Nitro</button>
</div>

<script>
const canvas = document.getElementById("road");
const ctx = canvas.getContext("2d");

let running = false;

let car = {
  x: 190,
  y: 400,
  w: 45,
  h: 80,
  speed: 6
};

let obstacles = [];
let score = 0;
let roadLineY = 0;

let baseSpeed = 5;
let currentSpeed = baseSpeed;

let nitro = false;
let nitroPower = 2.3;

let highScore = localStorage.getItem("mr7_car_high")
  ? parseInt(localStorage.getItem("mr7_car_high"))
  : 0;

document.getElementById("high").innerText = highScore;

let keys = {left:false, right:false};

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") keys.left=true;
  if(e.key==="ArrowRight") keys.right=true;

  if(e.key==="Shift" || e.key===" "){
    activateNitro();
  }
});

document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft") keys.left=false;
  if(e.key==="ArrowRight") keys.right=false;

  if(e.key==="Shift" || e.key===" "){
    deactivateNitro();
  }
});

function activateNitro(){
  nitro = true;
}
function deactivateNitro(){
  nitro = false;
}

function startGame(){
  if(running) return;
  running = true;

  document.getElementById("startBtn").style.display="none";

  obstacles = [];
  score = 0;
  baseSpeed = 5;
  currentSpeed = baseSpeed;
  roadLineY = 0;

  loop();
  setInterval(spawnObstacle, 1300);
}

function spawnObstacle(){
  if(!running) return;

  let laneX = [90, 190, 290]; // 3 lanes
  let randomLane = laneX[Math.floor(Math.random()*laneX.length)];

  obstacles.push({
    x: randomLane,
    y: -100,
    w: 45,
    h: 80
  });
}

function drawRoad(){
  ctx.fillStyle="#050505";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Road border
  ctx.strokeStyle="#00ff00";
  ctx.lineWidth=3;
  ctx.strokeRect(10,10,canvas.width-20,canvas.height-20);

  // Moving dashed lines
  ctx.strokeStyle="#00ff00";
  ctx.lineWidth=3;
  ctx.setLineDash([20,20]);

  ctx.beginPath();
  ctx.moveTo(canvas.width/2, roadLineY);
  ctx.lineTo(canvas.width/2, canvas.height);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(canvas.width/4, roadLineY);
  ctx.lineTo(canvas.width/4, canvas.height);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(canvas.width*0.75, roadLineY);
  ctx.lineTo(canvas.width*0.75, canvas.height);
  ctx.stroke();

  ctx.setLineDash([]);

  roadLineY += currentSpeed * 2;
  if(roadLineY > canvas.height) roadLineY = 0;
}

function drawPlayerCar(){
  ctx.shadowBlur = 20;
  ctx.shadowColor = "#00ff00";

  // Car body
  ctx.fillStyle = "#00ff00";
  ctx.fillRect(car.x, car.y, car.w, car.h);

  // Windows
  ctx.shadowBlur = 0;
  ctx.fillStyle = "#003300";
  ctx.fillRect(car.x+8, car.y+12, car.w-16, 20);

  // Wheels
  ctx.fillStyle = "#000";
  ctx.fillRect(car.x-6, car.y+10, 6, 18);
  ctx.fillRect(car.x-6, car.y+50, 6, 18);
  ctx.fillRect(car.x+car.w, car.y+10, 6, 18);
  ctx.fillRect(car.x+car.w, car.y+50, 6, 18);

  // Nitro Flame
  if(nitro){
    ctx.shadowBlur=20;
    ctx.shadowColor="cyan";
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(car.x+car.w/2, car.y+car.h+12, 10, 0, Math.PI*2);
    ctx.fill();
    ctx.shadowBlur=0;
  }
}

function drawObstacles(){
  obstacles.forEach(o=>{
    ctx.shadowBlur = 20;
    ctx.shadowColor = "red";

    ctx.fillStyle="red";
    ctx.fillRect(o.x, o.y, o.w, o.h);

    // window
    ctx.shadowBlur = 0;
    ctx.fillStyle="#330000";
    ctx.fillRect(o.x+8, o.y+12, o.w-16, 20);

    // wheels
    ctx.fillStyle="#000";
    ctx.fillRect(o.x-6, o.y+10, 6, 18);
    ctx.fillRect(o.x-6, o.y+50, 6, 18);
    ctx.fillRect(o.x+o.w, o.y+10, 6, 18);
    ctx.fillRect(o.x+o.w, o.y+50, 6, 18);

    o.y += currentSpeed + 2;
  });

  obstacles = obstacles.filter(o => o.y < canvas.height + 120);
}

function moveCar(){
  let steeringSpeed = 6;

  if(keys.left) car.x -= steeringSpeed;
  if(keys.right) car.x += steeringSpeed;

  // Road boundary
  if(car.x < 20) car.x = 20;
  if(car.x > canvas.width - car.w - 20) car.x = canvas.width - car.w - 20;
}

function checkCollision(){
  for(let o of obstacles){
    if(car.x < o.x + o.w &&
       car.x + car.w > o.x &&
       car.y < o.y + o.h &&
       car.y + car.h > o.y){
      return true;
    }
  }
  return false;
}

function updateScore(){
  score++;
  document.getElementById("score").innerText = score;

  // Speed increase every 500 points
  if(score % 500 === 0){
    baseSpeed += 0.6;
  }

  currentSpeed = nitro ? baseSpeed * nitroPower : baseSpeed;

  document.getElementById("speed").innerText = currentSpeed.toFixed(1);

  if(score > highScore){
    highScore = score;
    localStorage.setItem("mr7_car_high", highScore);
    document.getElementById("high").innerText = highScore;
  }
}

function gameOver(){
  running = false;
  alert("Game Over! Score: " + score);

  document.getElementById("startBtn").style.display="block";
  document.getElementById("score").innerText = 0;
  document.getElementById("speed").innerText = 5;

  obstacles = [];
  score = 0;
  baseSpeed = 5;
  currentSpeed = baseSpeed;

  car.x = 190;
}

function loop(){
  if(!running) return;

  drawRoad();
  moveCar();
  drawPlayerCar();
  drawObstacles();

  updateScore();

  if(checkCollision()){
    gameOver();
    return;
  }

  requestAnimationFrame(loop);
}
</script>

</body>
</html>
