<script>
/* PRELOADER */
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("preloader").style.display = "none";
  }, 1200);

  let logged = localStorage.getItem("mr7Login");
  if (logged === "true") {
    openSection("mainMenu");
    startTypingTitle();
  } else {
    openSection("loginPage");
  }
});

/* PARTICLES CREATE */
for (let i = 0; i < 35; i++) {
  let p = document.createElement("div");
  p.className = "particle";
  p.style.left = Math.random() * 100 + "%";
  p.style.top = Math.random() * 100 + "%";
  p.style.animationDuration = (3 + Math.random() * 6) + "s";
  document.body.appendChild(p);
}

/* DOTS MENU */
function toggleDots() {
  let menu = document.getElementById("dotsMenu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}
function closeDots() {
  document.getElementById("dotsMenu").style.display = "none";
}
document.addEventListener("click", (e) => {
  if (!e.target.classList.contains("dots") && !e.target.closest("#dotsMenu")) {
    closeDots();
  }
});

/* OPEN SECTION */
function openSection(id) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* TYPING TITLE */
function startTypingTitle() {
  let text = "- MR7 WORLD -";
  let i = 0;
  let el = document.getElementById("typingTitle");
  el.innerHTML = "";
  let t = setInterval(() => {
    el.innerHTML += text.charAt(i);
    i++;
    if (i >= text.length) clearInterval(t);
  }, 120);
}

/* DARK MODE SAVE */
function applyMode() {
  let mode = localStorage.getItem("mode") || "dark";
  if (mode === "light") document.body.classList.add("light");
  else document.body.classList.remove("light");
}
applyMode();

function toggleMode() {
  if (document.body.classList.contains("light")) {
    document.body.classList.remove("light");
    localStorage.setItem("mode", "dark");
  } else {
    document.body.classList.add("light");
    localStorage.setItem("mode", "light");
  }
}

/* EMAIL VALIDATION */
function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
}

/* LOGIN SYSTEM */
function loginUser() {
  let email = document.getElementById("loginEmail").value.trim();
  let pass = document.getElementById("loginPassword").value.trim();
  let status = document.getElementById("loginStatus");

  if (!email || !pass) {
    status.style.color = "red";
    status.innerText = "‚ùå Email and Password required!";
    return;
  }

  if (!isValidEmail(email)) {
    status.style.color = "red";
    status.innerText = "‚ùå Invalid Email! Please enter correct email.";
    return;
  }

  if (pass.length < 4) {
    status.style.color = "red";
    status.innerText = "‚ùå Password must be minimum 4 characters!";
    return;
  }

  localStorage.setItem("mr7Login", "true");
  localStorage.setItem("mr7Email", email);

  status.style.color = "lime";
  status.innerText = "‚úÖ Login Successful Boss üòéüî•";

  setTimeout(() => {
    openSection("mainMenu");
    startTypingTitle();
  }, 600);
}

function logoutUser() {
  localStorage.removeItem("mr7Login");
  localStorage.removeItem("mr7Email");
  closeDots();
  openSection("loginPage");
}

/* CONTACT EMAIL */
function sendMail() {
  let n = document.getElementById("name").value.trim();
  let m = document.getElementById("mobile").value.trim();
  let msg = document.getElementById("message").value.trim();

  if (!n || !msg) {
    alert("Please enter Name and Message üòÖ");
    return;
  }

  let subject = encodeURIComponent("MR7 Help from " + n);
  let body = encodeURIComponent("Name: " + n + "\nMobile: " + m + "\n\nMessage:\n" + msg);

  location.href = "mailto:mrrehanofficial.1777@gmail.com?subject=" + subject + "&body=" + body;
}

/* =======================
   SUPER SMART AI (HINGLISH ONLY)
======================= */
let chat = document.getElementById("chat");
let aiInput = document.getElementById("aiInput");

function addMsg(text, cls) {
  let div = document.createElement("div");
  div.className = cls;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function smartAI(q) {
  let text = q.toLowerCase().trim();

  // calculator
  if (text.startsWith("calc")) {
    try {
      let exp = text.replace("calc", "").trim();
      if (!exp) return "Boss example: calc 50+20";
      let result = eval(exp);
      return "Boss result is: " + result;
    } catch {
      return "Boss calculator error! Example: calc 50+20";
    }
  }

  // greetings
  if (text.includes("hello") || text.includes("hi") || text.includes("hey")) {
    return "Hello Boss üòé MR7 AI online hai! Ask anything!";
  }

  // who are you
  if (text.includes("who are you") || text.includes("tum kaun ho") || text.includes("tu kaun hai")) {
    return "Main MR7 AI hoon Boss ü§ñüî• Coding, YouTube and gaming me help karunga!";
  }

  // time/date
  if (text.includes("time")) {
    return "Boss current time: " + new Date().toLocaleTimeString();
  }

  if (text.includes("date") || text.includes("day")) {
    return "Boss current date: " + new Date().toLocaleDateString();
  }

  // tech topics
  if (text.includes("python")) {
    return "Python best hai Boss! Automation, AI, web development sab me use hota hai.";
  }

  if (text.includes("html")) {
    return "HTML website ka skeleton hota hai Boss. Structure banata hai.";
  }

  if (text.includes("css")) {
    return "CSS se website ka design, colors, animations aur layout set hota hai Boss.";
  }

  if (text.includes("javascript") || text.includes("js")) {
    return "JavaScript website ko alive banata hai Boss. Buttons, AI, games sab JS se hota hai.";
  }

  // youtube
  if (text.includes("youtube") && (text.includes("grow") || text.includes("views") || text.includes("subs"))) {
    return "Boss YouTube grow ka secret: consistency + strong thumbnail + trending topic + shorts daily.";
  }

  if (text.includes("thumbnail")) {
    return "Boss thumbnail tip: bright background + bold text + face zoom + max 3 words.";
  }

  // football
  if (text.includes("football") || text.includes("ronaldo") || text.includes("messi")) {
    return "Boss football improve karne ke liye: daily dribbling + cone practice + stamina running 30 min.";
  }

  // motivation
  if (text.includes("sad") || text.includes("tension") || text.includes("motivation")) {
    return "Boss tension mat lo üòé Consistency rakho, tum definitely top pe jaoge!";
  }

  // general question
  if (text.includes("how") || text.includes("kaise") || text.includes("kya") || text.includes("kyu")) {
    return "Boss bilkul! Detail me bolo, main full clear answer de dunga.";
  }

  let random = [
    "Boss interesting question üòé Thoda detail do main best answer dunga.",
    "MR7 AI says: consistency is the real power üî•",
    "Boss tum kuch bada plan kar rahe ho üòé main ready hoon.",
    "Boss tip: goal ko small steps me divide karo and daily complete karo.",
    "Boss ye easy hai üòÑ bas thoda clear batao."
  ];

  return random[Math.floor(Math.random() * random.length)];
}

/* AI TYPING EFFECT */
function typeAIReply(reply) {
  let div = document.createElement("div");
  div.className = "bot";
  chat.appendChild(div);

  let i = 0;
  let typing = setInterval(() => {
    div.innerText = "AI: " + reply.substring(0, i);
    i++;
    chat.scrollTop = chat.scrollHeight;

    if (i > reply.length) {
      clearInterval(typing);
    }
  }, 20);
}

function askAI() {
  let q = aiInput.value.trim();
  if (!q) return;

  addMsg("You: " + q, "user");
  aiInput.value = "";

  setTimeout(() => {
    let reply = smartAI(q);
    typeAIReply(reply);
  }, 300);
}

aiInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") askAI();
});

function clearChat() {
  if (confirm("Clear full chat?")) {
    chat.innerHTML = "";
  }
}

/* =======================
   GAME OPEN FIX
======================= */
function openGame(id) {
  document.getElementById("snakeBox").style.display = "none";
  document.getElementById("carBox").style.display = "none";
  document.getElementById("tttBox").style.display = "none";

  document.getElementById(id).style.display = "block";
}

function closeGames() {
  document.getElementById("snakeBox").style.display = "none";
  document.getElementById("carBox").style.display = "none";
  document.getElementById("tttBox").style.display = "none";
}

/* =======================
   SNAKE GAME
======================= */
let snakeCanvas = document.getElementById("snakeCanvas");
let sctx = snakeCanvas.getContext("2d");

let snake, food, dir, snakeInterval;

function resetSnake() {
  snake = [{ x: 160, y: 160 }];
  food = { x: 80, y: 80 };
  dir = "RIGHT";
}

function drawSnake() {
  sctx.clearRect(0, 0, 320, 320);

  sctx.fillStyle = "red";
  sctx.fillRect(food.x, food.y, 20, 20);

  sctx.fillStyle = "lime";
  snake.forEach(part => {
    sctx.fillRect(part.x, part.y, 20, 20);
  });
}

function moveSnake() {
  let head = { ...snake[0] };

  if (dir === "RIGHT") head.x += 20;
  if (dir === "LEFT") head.x -= 20;
  if (dir === "UP") head.y -= 20;
  if (dir === "DOWN") head.y += 20;

  if (head.x < 0 || head.y < 0 || head.x >= 320 || head.y >= 320) {
    clearInterval(snakeInterval);
    alert("Game Over üò≠");
    return;
  }

  for (let i = 1; i < snake.length; i++) {
    if (snake[i].x === head.x && snake[i].y === head.y) {
      clearInterval(snakeInterval);
      alert("Game Over üò≠");
      return;
    }
  }

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    food = {
      x: Math.floor(Math.random() * 16) * 20,
      y: Math.floor(Math.random() * 16) * 20
    };
  } else {
    snake.pop();
  }

  drawSnake();
}

function startSnake() {
  resetSnake();
  drawSnake();
  clearInterval(snakeInterval);
  snakeInterval = setInterval(moveSnake, 140);
}

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowUp" && dir !== "DOWN") dir = "UP";
  if (e.key === "ArrowDown" && dir !== "UP") dir = "DOWN";
  if (e.key === "ArrowLeft" && dir !== "RIGHT") dir = "LEFT";
  if (e.key === "ArrowRight" && dir !== "LEFT") dir = "RIGHT";
});

let startX = 0, startY = 0;
snakeCanvas.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});
snakeCanvas.addEventListener("touchend", (e) => {
  let endX = e.changedTouches[0].clientX;
  let endY = e.changedTouches[0].clientY;
  let dx = endX - startX;
  let dy = endY - startY;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 0 && dir !== "LEFT") dir = "RIGHT";
    if (dx < 0 && dir !== "RIGHT") dir = "LEFT";
  } else {
    if (dy > 0 && dir !== "UP") dir = "DOWN";
    if (dy < 0 && dir !== "DOWN") dir = "UP";
  }
});

/* =======================
   CAR GAME
======================= */
let carCanvas = document.getElementById("carCanvas");
let cctx = carCanvas.getContext("2d");

let playerCar, enemies, carScore, carInterval;

function resetCar() {
  playerCar = { x: 140, y: 320, w: 40, h: 70, speed: 6 };
  enemies = [
    { x: 60, y: -120, w: 40, h: 70, speed: 5 },
    { x: 220, y: -400, w: 40, h: 70, speed: 6 }
  ];
  carScore = 0;
}

function drawRealCar(x, y, w, h, color) {
  cctx.fillStyle = color;
  cctx.fillRect(x, y, w, h);

  cctx.fillStyle = "black";
  cctx.fillRect(x + 6, y + 10, w - 12, h / 3);

  cctx.fillStyle = "#66ccff";
  cctx.fillRect(x + 10, y + 14, w - 20, 18);

  cctx.fillStyle = "#111";
  cctx.fillRect(x - 6, y + 10, 8, 18);
  cctx.fillRect(x + w - 2, y + 10, 8, 18);
  cctx.fillRect(x - 6, y + h - 28, 8, 18);
  cctx.fillRect(x + w - 2, y + h - 28, 8, 18);

  cctx.fillStyle = "yellow";
  cctx.fillRect(x + 5, y + h - 6, 8, 6);
  cctx.fillRect(x + w - 13, y + h - 6, 8, 6);
}

function drawCarGame() {
  cctx.clearRect(0, 0, 320, 420);

  cctx.fillStyle = "#2a2a2a";
  cctx.fillRect(0, 0, 320, 420);

  cctx.fillStyle = "#111";
  cctx.fillRect(0, 0, 40, 420);
  cctx.fillRect(280, 0, 40, 420);

  cctx.strokeStyle = "white";
  cctx.lineWidth = 4;
  cctx.setLineDash([20, 20]);
  cctx.beginPath();
  cctx.moveTo(160, 0);
  cctx.lineTo(160, 420);
  cctx.stroke();
  cctx.setLineDash([]);

  cctx.fillStyle = "yellow";
  cctx.font = "bold 18px Arial";
  cctx.fillText("Score: " + carScore, 15, 30);

  drawRealCar(playerCar.x, playerCar.y, playerCar.w, playerCar.h, "lime");

  enemies.forEach(e => {
    drawRealCar(e.x, e.y, e.w, e.h, "red");
  });
}

function updateCarGame() {
  enemies.forEach(e => {
    e.y += e.speed;

    if (playerCar.x < e.x + e.w &&
      playerCar.x + playerCar.w > e.x &&
      playerCar.y < e.y + e.h &&
      playerCar.y + playerCar.h > e.y) {
      clearInterval(carInterval);
      alert("üí• Crash! Game Over! Score: " + carScore);
    }

    if (e.y > 450) {
      e.y = -Math.random() * 300 - 100;
      e.x = 60 + Math.random() * 160;
      carScore++;
    }
  });

  drawCarGame();
}

function startCar() {
  resetCar();
  drawCarGame();
  clearInterval(carInterval);
  carInterval = setInterval(updateCarGame, 30);
}

document.addEventListener("keydown", (e) => {
  if (!playerCar) return;

  if (e.key === "ArrowLeft") playerCar.x -= playerCar.speed * 3;
  if (e.key === "ArrowRight") playerCar.x += playerCar.speed * 3;

  if (playerCar.x < 45) playerCar.x = 45;
  if (playerCar.x > 235) playerCar.x = 235;
});

carCanvas.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
});
carCanvas.addEventListener("touchmove", (e) => {
  if (!playerCar) return;

  let x = e.touches[0].clientX;
  let diff = x - startX;

  playerCar.x += diff * 0.2;
  startX = x;

  if (playerCar.x < 45) playerCar.x = 45;
  if (playerCar.x > 235) playerCar.x = 235;
});

/* =======================
   TIC TAC TOE
======================= */
let tttBoard = document.getElementById("tttBoard");
let tttStatus = document.getElementById("tttStatus");
let tttCells = [], currentPlayer = "X";

function createTTT() {
  tttBoard.innerHTML = "";
  tttCells = new Array(9).fill("");
  currentPlayer = "X";
  tttStatus.innerText = "Player X turn";

  for (let i = 0; i < 9; i++) {
    let btn = document.createElement("button");
    btn.style.height = "80px";
    btn.style.fontSize = "30px";
    btn.style.borderRadius = "15px";
    btn.style.border = "2px solid lime";
    btn.style.cursor = "pointer";
    btn.style.background = "#111";
    btn.style.color = "lime";
    btn.innerText = "";

    btn.onclick = () => playTTT(i, btn);
    tttBoard.appendChild(btn);
  }
}
createTTT();

function playTTT(i, btn) {
  if (tttCells[i] !== "") return;

  tttCells[i] = currentPlayer;
  btn.innerText = currentPlayer;

  if (checkWin()) {
    tttStatus.innerText = "üèÜ Player " + currentPlayer + " Wins!";
    return;
  }

  if (tttCells.every(c => c !== "")) {
    tttStatus.innerText = "üòê Draw!";
    return;
  }

  currentPlayer = currentPlayer === "X" ? "O" : "X";
  tttStatus.innerText = "Player " + currentPlayer + " turn";
}

function checkWin() {
  let w = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];

  return w.some(p => {
    return tttCells[p[0]] &&
      tttCells[p[0]] === tttCells[p[1]] &&
      tttCells[p[1]] === tttCells[p[2]];
  });
}

function resetTTT() {
  createTTT();
}
</script>
