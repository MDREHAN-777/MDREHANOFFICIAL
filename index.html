<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title> - MR7 WORLD - </title>

<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Arial,sans-serif;}
    body{
        background:#000;
        color:#0f0;
        overflow-x:hidden;
    }

    /* PRELOADER */
    #preloader{
        position:fixed;
        top:0;left:0;
        width:100%;height:100%;
        background:black;
        display:flex;
        justify-content:center;
        align-items:center;
        flex-direction:column;
        z-index:9999;
    }
    .loader{
        width:80px;height:80px;
        border:6px solid #0f0;
        border-top:6px solid transparent;
        border-radius:50%;
        animation:spin 1s linear infinite;
        margin-bottom:15px;
        box-shadow:0 0 20px #0f0;
    }
    @keyframes spin{
        0%{transform:rotate(0deg);}
        100%{transform:rotate(360deg);}
    }

    /* PARTICLES */
    canvas#particles{
        position:fixed;
        top:0;left:0;
        width:100%;height:100%;
        z-index:-1;
    }

    /* HEADER */
    header{
        width:100%;
        padding:15px 20px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        border-bottom:2px solid rgba(0,255,0,0.2);
        background:rgba(0,0,0,0.7);
        position:sticky;
        top:0;
        z-index:50;
    }
    .logoBox{
        display:flex;
        align-items:center;
        gap:12px;
    }
    .logo{
        width:45px;height:45px;
        border-radius:50%;
        border:2px solid #0f0;
        display:flex;
        justify-content:center;
        align-items:center;
        font-weight:bold;
        color:#0f0;
        box-shadow:0 0 15px #0f0;
    }
    .title{
        font-size:22px;
        font-weight:bold;
    }
    .verified{
        color:#00ff88;
        font-size:14px;
        margin-left:6px;
    }
    .status{
        font-size:14px;
        display:flex;
        align-items:center;
        gap:6px;
        color:#00ff88;
    }
    .dot{
        width:10px;height:10px;
        background:#00ff88;
        border-radius:50%;
        box-shadow:0 0 10px #00ff88;
    }

    /* MAIN */
    .container{
        max-width:1100px;
        margin:auto;
        padding:20px;
    }

    .card{
        background:rgba(0,0,0,0.7);
        border:2px solid rgba(0,255,0,0.3);
        box-shadow:0 0 25px rgba(0,255,0,0.2);
        border-radius:20px;
        padding:20px;
        margin-top:20px;
    }

    h2{
        text-align:center;
        margin-bottom:10px;
        text-shadow:0 0 10px #0f0;
    }
    p{
        text-align:center;
        color:#8aff8a;
        margin-bottom:15px;
        font-size:14px;
    }

    /* MENU */
    .menu{
        display:flex;
        justify-content:center;
        gap:12px;
        flex-wrap:wrap;
        margin-top:10px;
    }
    .btn{
        padding:12px 18px;
        border:none;
        border-radius:12px;
        background:#00ff33;
        color:black;
        font-weight:bold;
        cursor:pointer;
        box-shadow:0 0 15px #00ff33;
        transition:0.2s;
    }
    .btn:hover{
        transform:scale(1.05);
    }

    /* SEARCH */
    .searchBox{
        display:flex;
        justify-content:center;
        margin:15px 0;
    }
    .searchBox input{
        width:80%;
        padding:12px;
        border-radius:12px;
        border:2px solid rgba(0,255,0,0.4);
        background:rgba(0,0,0,0.8);
        color:#0f0;
        outline:none;
        font-size:14px;
    }

    /* CHAT */
    #chatBox{
        height:260px;
        overflow-y:auto;
        border-radius:12px;
        border:2px solid rgba(0,255,0,0.3);
        padding:12px;
        background:rgba(0,0,0,0.7);
        margin-bottom:10px;
    }
    .msg{
        margin:8px 0;
        font-size:14px;
        line-height:1.4;
    }
    .you{color:#00ccff;}
    .ai{color:#00ff55;}
    .typing{
        font-style:italic;
        opacity:0.7;
    }

    .chatInput{
        display:flex;
        gap:10px;
    }
    .chatInput input{
        flex:1;
        padding:12px;
        border-radius:12px;
        border:2px solid rgba(0,255,0,0.3);
        background:rgba(0,0,0,0.8);
        color:#0f0;
        outline:none;
    }

    /* GAME CANVAS */
    canvas.gameCanvas{
        background:rgba(0,0,0,0.8);
        border:2px solid rgba(0,255,0,0.4);
        border-radius:14px;
        display:block;
        margin:15px auto;
        box-shadow:0 0 20px rgba(0,255,0,0.3);
    }

    /* MOBILE CONTROLS */
    .mobileControls{
        display:flex;
        justify-content:center;
        gap:15px;
        margin-top:10px;
        flex-wrap:wrap;
    }
    .controlBtn{
        width:70px;
        height:70px;
        border-radius:50%;
        border:none;
        background:#00ff33;
        font-weight:bold;
        font-size:20px;
        box-shadow:0 0 15px #00ff33;
        cursor:pointer;
    }

    /* FULLSCREEN BUTTON */
    .fullscreenBtn{
        position:fixed;
        bottom:20px;
        right:20px;
        padding:12px 18px;
        border-radius:14px;
        border:none;
        background:#00ff33;
        color:black;
        font-weight:bold;
        cursor:pointer;
        box-shadow:0 0 15px #00ff33;
        z-index:99;
    }

    /* POPUP */
    #popup{
        position:fixed;
        top:20px;
        right:20px;
        background:black;
        border:2px solid #0f0;
        padding:12px 18px;
        border-radius:12px;
        box-shadow:0 0 20px #0f0;
        z-index:999;
        display:none;
    }

    /* PAGE TRANSITION */
    .page{
        display:none;
        animation:fadeIn 0.4s ease;
    }
    .active{
        display:block;
    }
    @keyframes fadeIn{
        from{opacity:0;transform:scale(0.97);}
        to{opacity:1;transform:scale(1);}
    }

</style>
</head>

<body>

<!-- PRELOADER -->
<div id="preloader">
    <div class="loader"></div>
    <h2>Loading MR7 WORLD...</h2>
</div>

<!-- PARTICLES -->
<canvas id="particles"></canvas>

<!-- POPUP -->
<div id="popup">üî• Welcome to MR7 WORLD - Gaming + AI üòé</div>

<header>
    <div class="logoBox">
        <div class="logo">MR7</div>
        <div>
            <div class="title">MR7 WORLD <span class="verified">‚úî Verified</span></div>
            <small style="color:#66ff66;">Owner: MR7</small>
        </div>
    </div>
    <div class="status"><span class="dot"></span> Online</div>
</header>

<div class="container">

    <!-- SEARCH -->
    <div class="searchBox">
        <input id="searchInput" placeholder="Search: ai / snake / car / shooter / store ..." />
    </div>

    <!-- MENU -->
    <div class="menu">
        <button class="btn" onclick="openPage('homePage')">Home</button>
        <button class="btn" onclick="openPage('aiPage')">MR7 AI</button>
        <button class="btn" onclick="openPage('snakePage')">Snake</button>
        <button class="btn" onclick="openPage('carPage')">Car Race</button>
        <button class="btn" onclick="openPage('shootPage')">Space Shooter</button>
        <button class="btn" onclick="openPage('storePage')">MR7 Store</button>
    </div>

    <!-- HOME PAGE -->
    <div id="homePage" class="card page active">
        <h2>üî• MR7 WORLD</h2>
        <p>Gaming + AI + Cool Features üòé (All fixed version)</p>
        <h3 style="text-align:center;color:#00ff99;">Coins: <span id="coinCount">0</span> ü™ô</h3>
        <p style="margin-top:10px;">Play games, earn coins, buy skins, unlock achievements!</p>
    </div>

    <!-- AI PAGE -->
    <div id="aiPage" class="card page">
        <h2>MR7 AI Chat</h2>
        <p>Smart AI (Offline + Real OpenAI API Support)</p>

        <input id="apiKey" placeholder="Paste OpenAI API Key (optional)" style="width:100%;padding:12px;border-radius:12px;border:2px solid rgba(0,255,0,0.3);background:black;color:#0f0;outline:none;margin-bottom:10px;">

        <div id="chatBox"></div>

        <div class="chatInput">
            <input id="userInput" placeholder="Type message... (Enter = Send)" />
            <button class="btn" onclick="sendMessage()">Send</button>
        </div>
        <div style="margin-top:10px;text-align:center;">
            <button class="btn" onclick="clearChat()">Clear</button>
        </div>
    </div>

    <!-- SNAKE PAGE -->
    <div id="snakePage" class="card page">
        <h2>üêç Snake Game</h2>
        <p>Start button se game chalega (auto start OFF)</p>

        <canvas id="snakeCanvas" class="gameCanvas" width="400" height="400"></canvas>

        <div style="text-align:center;">
            <button class="btn" onclick="startSnake()">Start Snake</button>
        </div>

        <p style="margin-top:10px;">Score: <span id="snakeScore">0</span> | Best: <span id="snakeBest">0</span></p>
    </div>

    <!-- CAR PAGE -->
    <div id="carPage" class="card page">
        <h2>üöó MR7 Car Race</h2>
        <p>Realistic controls + Nitro Boost üî•</p>

        <canvas id="carCanvas" class="gameCanvas" width="400" height="500"></canvas>

        <div style="text-align:center;">
            <button class="btn" onclick="startCar()">Start Car Game</button>
            <button class="btn" onclick="nitroBoost()">Nitro ‚ö°</button>
        </div>

        <p style="margin-top:10px;">Score: <span id="carScore">0</span> | Best: <span id="carBest">0</span></p>

        <div class="mobileControls">
            <button class="controlBtn" ontouchstart="carLeft=true" ontouchend="carLeft=false">‚¨Ö</button>
            <button class="controlBtn" ontouchstart="carRight=true" ontouchend="carRight=false">‚û°</button>
        </div>
    </div>

    <!-- SHOOTER PAGE -->
    <div id="shootPage" class="card page">
        <h2>üöÄ Space Shooter</h2>
        <p>New Game Added! Shoot enemies and earn coins!</p>

        <canvas id="shootCanvas" class="gameCanvas" width="400" height="500"></canvas>

        <div style="text-align:center;">
            <button class="btn" onclick="startShooter()">Start Shooter</button>
        </div>

        <p style="margin-top:10px;">Score: <span id="shootScore">0</span> | Best: <span id="shootBest">0</span></p>
    </div>

    <!-- STORE PAGE -->
    <div id="storePage" class="card page">
        <h2>üõí MR7 Store</h2>
        <p>Coins use karke skins buy karo</p>

        <div style="text-align:center;">
            <button class="btn" onclick="buySkin('Red Car',50)">Buy Red Car Skin (50ü™ô)</button>
            <button class="btn" onclick="buySkin('Gold Car',100)">Buy Gold Car Skin (100ü™ô)</button>
        </div>

        <p style="margin-top:15px;">Owned Skins: <span id="ownedSkins">None</span></p>
    </div>

</div>

<button class="fullscreenBtn" onclick="goFullScreen()">üì± Fullscreen</button>

<script>
/* PRELOADER */
window.onload = function(){
    setTimeout(()=>{
        document.getElementById("preloader").style.display="none";
        showPopup();
        initParticles();
        loadData();
        aiWelcome();
    },1200);
};

/* POPUP */
function showPopup(){
    const pop = document.getElementById("popup");
    pop.style.display="block";
    setTimeout(()=>pop.style.display="none",3500);
}

/* PAGE OPEN */
function openPage(id){
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

/* SEARCH SYSTEM */
document.getElementById("searchInput").addEventListener("keyup", function(){
    let v = this.value.toLowerCase();
    if(v.includes("ai")) openPage("aiPage");
    if(v.includes("snake")) openPage("snakePage");
    if(v.includes("car")) openPage("carPage");
    if(v.includes("shoot")) openPage("shootPage");
    if(v.includes("store")) openPage("storePage");
});

/* FULLSCREEN */
function goFullScreen(){
    let elem = document.documentElement;
    if(elem.requestFullscreen) elem.requestFullscreen();
}

/* LOCAL STORAGE DATA */
let coins = 0;
let skins = [];

function loadData(){
    coins = parseInt(localStorage.getItem("mr7Coins")) || 0;
    skins = JSON.parse(localStorage.getItem("mr7Skins")) || [];
    document.getElementById("coinCount").innerText = coins;
    document.getElementById("ownedSkins").innerText = skins.length ? skins.join(", ") : "None";

    document.getElementById("snakeBest").innerText = localStorage.getItem("snakeBest") || 0;
    document.getElementById("carBest").innerText = localStorage.getItem("carBest") || 0;
    document.getElementById("shootBest").innerText = localStorage.getItem("shootBest") || 0;
}

function saveCoins(){
    localStorage.setItem("mr7Coins", coins);
    document.getElementById("coinCount").innerText = coins;
}

/* STORE */
function buySkin(name, price){
    if(coins < price){
        alert("Not enough coins boss üò≠");
        return;
    }
    if(skins.includes(name)){
        alert("Already owned boss üòé");
        return;
    }
    coins -= price;
    skins.push(name);
    localStorage.setItem("mr7Skins", JSON.stringify(skins));
    document.getElementById("ownedSkins").innerText = skins.join(", ");
    saveCoins();
    alert("Skin unlocked: " + name + " üî•");
}

/* PARTICLES BACKGROUND */
function initParticles(){
    const canvas = document.getElementById("particles");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particles = [];
    for(let i=0;i<80;i++){
        particles.push({
            x:Math.random()*canvas.width,
            y:Math.random()*canvas.height,
            r:Math.random()*2+1,
            dx:(Math.random()-0.5)*1.5,
            dy:(Math.random()-0.5)*1.5
        });
    }

    function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#00ff55";
        particles.forEach(p=>{
            ctx.beginPath();
            ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
            ctx.fill();

            p.x+=p.dx;
            p.y+=p.dy;

            if(p.x<0||p.x>canvas.width) p.dx*=-1;
            if(p.y<0||p.y>canvas.height) p.dy*=-1;
        });

        requestAnimationFrame(animate);
    }
    animate();

    window.onresize=()=>{
        canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
    }
}

/* ---------------- MR7 AI CHAT ---------------- */
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");

function aiWelcome(){
    addMsg("AI", "Hello Boss üòé Ask me anything! (Enter = Send)");
}

function addMsg(who, text){
    let div = document.createElement("div");
    div.className="msg";
    div.innerHTML = `<span class="${who==='YOU'?'you':'ai'}">${who}:</span> ${text}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function clearChat(){
    chatBox.innerHTML="";
    aiWelcome();
}

userInput.addEventListener("keydown", function(e){
    if(e.key==="Enter"){
        sendMessage();
    }
});

async function sendMessage(){
    let msg = userInput.value.trim();
    if(!msg) return;

    addMsg("YOU", msg);
    userInput.value="";

    // typing effect
    let typingDiv = document.createElement("div");
    typingDiv.className="msg typing";
    typingDiv.innerText="AI is typing...";
    chatBox.appendChild(typingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    let apiKey = document.getElementById("apiKey").value.trim();

    try{
        let reply = "";

        if(apiKey.startsWith("sk-")){
            // REAL OPENAI API
            reply = await callOpenAI(apiKey, msg);
        }else{
            // OFFLINE SMART AI
            reply = offlineAI(msg);
        }

        typingDiv.remove();
        addMsg("AI", reply);

    }catch(err){
        typingDiv.remove();
        addMsg("AI", "Boss error aa gaya üò≠ API issue / network problem.");
    }
}

/* OFFLINE AI SMART */
function offlineAI(text){
    text = text.toLowerCase();

    if(text.includes("hello") || text.includes("hi")) return "Hello Boss üòé Kaise ho?";
    if(text.includes("time")) return "Boss current time aapke device ke hisaab se hota hai ‚è∞";
    if(text.includes("date")) return "Boss aap apne phone/pc me date check kar sakte ho üìÖ";
    if(text.includes("python")) return "Python ek powerful language hai boss üî• Web, AI, automation sab me use hota hai.";
    if(text.includes("who are you")) return "Main MR7 AI hoon boss üòé Gaming + Tech assistant.";
    if(text.includes("mr7")) return "MR7 WORLD ka king aap ho boss üëëüî•";
    if(text.includes("weather")) return "Boss weather live dekhne ke liye API chahiye (OpenWeather) ya Google weather use karo üå¶";
    if(text.includes("news")) return "Boss live news ke liye API chahiye. Agar OpenAI API key doge to mai best news summary de dunga üî•";

    return "Boss ye interesting question hai üòé Agar aap OpenAI API key add kar doge to mai full ChatGPT jaisa answer de paunga.";
}

/* REAL OPENAI CALL */
async function callOpenAI(apiKey, prompt){
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer " + apiKey
        },
        body: JSON.stringify({
            model:"gpt-4o-mini",
            messages:[
                {role:"system", content:"You are MR7 AI. Always reply in Hinglish only. Never use Hindi script. Be fast, smart and friendly."},
                {role:"user", content: prompt}
            ],
            max_tokens:200
        })
    });

    const data = await res.json();
    if(data.error) return "Boss API error: " + data.error.message;

    return data.choices[0].message.content;
}

/* ---------------- SNAKE GAME ---------------- */
const snakeCanvas = document.getElementById("snakeCanvas");
const sctx = snakeCanvas.getContext("2d");

let snake, food, snakeDir, snakeScore, snakeInterval;
let snakeRunning = false;

function startSnake(){
    snake = [{x:200,y:200}];
    food = {x:Math.floor(Math.random()*20)*20, y:Math.floor(Math.random()*20)*20};
    snakeDir = "RIGHT";
    snakeScore = 0;
    document.getElementById("snakeScore").innerText = snakeScore;

    if(snakeInterval) clearInterval(snakeInterval);
    snakeRunning = true;
    snakeInterval = setInterval(updateSnake, 120);
}

document.addEventListener("keydown", (e)=>{
    if(!snakeRunning) return;
    if(e.key==="ArrowUp" && snakeDir!=="DOWN") snakeDir="UP";
    if(e.key==="ArrowDown" && snakeDir!=="UP") snakeDir="DOWN";
    if(e.key==="ArrowLeft" && snakeDir!=="RIGHT") snakeDir="LEFT";
    if(e.key==="ArrowRight" && snakeDir!=="LEFT") snakeDir="RIGHT";
});

function updateSnake(){
    let head = {...snake[0]};

    if(snakeDir==="UP") head.y-=20;
    if(snakeDir==="DOWN") head.y+=20;
    if(snakeDir==="LEFT") head.x-=20;
    if(snakeDir==="RIGHT") head.x+=20;

    // collision wall
    if(head.x<0 || head.y<0 || head.x>=400 || head.y>=400){
        return snakeGameOver();
    }

    // collision self
    for(let i=0;i<snake.length;i++){
        if(head.x===snake[i].x && head.y===snake[i].y){
            return snakeGameOver();
        }
    }

    snake.unshift(head);

    // eat food
    if(head.x===food.x && head.y===food.y){
        snakeScore += 10;
        document.getElementById("snakeScore").innerText = snakeScore;
        coins += 2;
        saveCoins();

        food = {x:Math.floor(Math.random()*20)*20, y:Math.floor(Math.random()*20)*20};
    }else{
        snake.pop();
    }

    drawSnake();
}

function drawSnake(){
    sctx.clearRect(0,0,400,400);

    // grid
    sctx.strokeStyle="rgba(0,255,0,0.08)";
    for(let i=0;i<400;i+=20){
        sctx.beginPath();
        sctx.moveTo(i,0); sctx.lineTo(i,400);
        sctx.stroke();
        sctx.beginPath();
        sctx.moveTo(0,i); sctx.lineTo(400,i);
        sctx.stroke();
    }

    // food
    sctx.fillStyle="#ff0000";
    sctx.shadowColor="red";
    sctx.shadowBlur=15;
    sctx.fillRect(food.x, food.y, 20, 20);

    // snake
    sctx.shadowBlur=0;
    snake.forEach((p, index)=>{
        sctx.fillStyle = index===0 ? "#00ff99" : "#00ff33";
        sctx.fillRect(p.x, p.y, 20, 20);
    });
}

function snakeGameOver(){
    snakeRunning = false;
    clearInterval(snakeInterval);

    let best = parseInt(localStorage.getItem("snakeBest")) || 0;
    if(snakeScore > best){
        best = snakeScore;
        localStorage.setItem("snakeBest", best);
    }
    document.getElementById("snakeBest").innerText = best;

    alert("Snake Game Over! Score: " + snakeScore);
}

/* ---------------- CAR GAME ---------------- */
const carCanvas = document.getElementById("carCanvas");
const cctx = carCanvas.getContext("2d");

let carX, carY, roadLines, carEnemies, carScore, carSpeed;
let carInterval;
let carRunning=false;
let carLeft=false, carRight=false;
let nitroActive=false;

function startCar(){
    carX = 180;
    carY = 400;
    carScore = 0;
    carSpeed = 5;
    roadLines = [];
    carEnemies = [];
    carRunning=true;
    document.getElementById("carScore").innerText=carScore;

    if(carInterval) cancelAnimationFrame(carInterval);
    carLoop();
}

function nitroBoost(){
    if(!carRunning) return;
    nitroActive=true;
    carSpeed = 10;
    setTimeout(()=>{
        carSpeed=5;
        nitroActive=false;
    },1500);
}

document.addEventListener("keydown", (e)=>{
    if(!carRunning) return;
    if(e.key==="ArrowLeft") carLeft=true;
    if(e.key==="ArrowRight") carRight=true;
});
document.addEventListener("keyup", (e)=>{
    if(e.key==="ArrowLeft") carLeft=false;
    if(e.key==="ArrowRight") carRight=false;
});

function carLoop(){
    if(!carRunning) return;

    cctx.clearRect(0,0,400,500);

    // road
    cctx.fillStyle="rgba(0,0,0,0.9)";
    cctx.fillRect(0,0,400,500);

    // road lines
    if(roadLines.length<15){
        roadLines.push({x:195,y:0});
    }
    roadLines.forEach(line=>{
        cctx.fillStyle="rgba(0,255,0,0.5)";
        cctx.fillRect(line.x, line.y, 10, 40);
        line.y += carSpeed;
    });
    roadLines = roadLines.filter(l=>l.y<500);

    // move car
    if(carLeft) carX -= 6;
    if(carRight) carX += 6;

    if(carX<0) carX=0;
    if(carX>360) carX=360;

    // enemies spawn
    if(Math.random()<0.03){
        carEnemies.push({x:Math.random()*360, y:-50});
    }

    // draw enemies
    carEnemies.forEach(e=>{
        e.y += carSpeed;
        cctx.font="35px Arial";
        cctx.fillText("üöô", e.x, e.y);
    });
    carEnemies = carEnemies.filter(e=>e.y<550);

    // collision
    carEnemies.forEach(e=>{
        if(Math.abs(carX - e.x) < 30 && Math.abs(carY - e.y) < 30){
            return carGameOver();
        }
    });

    // draw player car
    cctx.font="40px Arial";
    cctx.fillText(nitroActive ? "üèéÔ∏è" : "üöó", carX, carY);

    // score
    carScore++;
    document.getElementById("carScore").innerText=carScore;

    if(carScore % 100 === 0){
        coins += 5;
        saveCoins();
    }

    carInterval = requestAnimationFrame(carLoop);
}

function carGameOver(){
    carRunning=false;
    cancelAnimationFrame(carInterval);

    let best = parseInt(localStorage.getItem("carBest")) || 0;
    if(carScore > best){
        best = carScore;
        localStorage.setItem("carBest", best);
    }
    document.getElementById("carBest").innerText = best;

    alert("Car Crash! Score: " + carScore);
}

/* ---------------- SPACE SHOOTER ---------------- */
const shootCanvas = document.getElementById("shootCanvas");
const shctx = shootCanvas.getContext("2d");

let player, bullets, enemies, shootScore;
let shooterRunning=false;
let shooterAnim;

function startShooter(){
    player = {x:180,y:430};
    bullets=[];
    enemies=[];
    shootScore=0;
    shooterRunning=true;
    document.getElementById("shootScore").innerText=shootScore;
    shooterLoop();
}

document.addEventListener("keydown",(e)=>{
    if(!shooterRunning) return;
    if(e.key==="ArrowLeft") player.x-=15;
    if(e.key==="ArrowRight") player.x+=15;
    if(e.key===" "){
        bullets.push({x:player.x+10,y:player.y});
    }
});

function shooterLoop(){
    if(!shooterRunning) return;

    shctx.clearRect(0,0,400,500);

    shctx.fillStyle="rgba(0,0,0,0.9)";
    shctx.fillRect(0,0,400,500);

    // spawn enemies
    if(Math.random()<0.03){
        enemies.push({x:Math.random()*360,y:-30});
    }

    // draw player
    shctx.font="35px Arial";
    shctx.fillText("üöÄ", player.x, player.y);

    // bullets
    bullets.forEach(b=>{
        b.y -= 8;
        shctx.fillStyle="#00ff55";
        shctx.fillRect(b.x, b.y, 5, 15);
    });
    bullets = bullets.filter(b=>b.y>0);

    // enemies
    enemies.forEach(en=>{
        en.y += 4;
        shctx.font="30px Arial";
        shctx.fillText("üëæ", en.x, en.y);
    });
    enemies = enemies.filter(en=>en.y<520);

    // collision bullet enemy
    enemies.forEach((en,ei)=>{
        bullets.forEach((b,bi)=>{
            if(Math.abs(en.x-b.x)<20 && Math.abs(en.y-b.y)<20){
                enemies.splice(ei,1);
                bullets.splice(bi,1);
                shootScore += 10;
                document.getElementById("shootScore").innerText=shootScore;
                coins += 3;
                saveCoins();
            }
        });
    });

    // collision player enemy
    enemies.forEach(en=>{
        if(Math.abs(en.x-player.x)<30 && Math.abs(en.y-player.y)<30){
            return shooterOver();
        }
    });

    shooterAnim = requestAnimationFrame(shooterLoop);
}

function shooterOver(){
    shooterRunning=false;
    cancelAnimationFrame(shooterAnim);

    let best = parseInt(localStorage.getItem("shootBest")) || 0;
    if(shootScore > best){
        best = shootScore;
        localStorage.setItem("shootBest", best);
    }
    document.getElementById("shootBest").innerText = best;

    alert("Shooter Game Over! Score: " + shootScore);
}
</script>

</body>
</html>
